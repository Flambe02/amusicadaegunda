<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Test Admin Access</title>
  <script type="module">
    import { createClient } from 'https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2/+esm'
    
    const supabaseUrl = 'https://efnzmpzkzeuktqkghwfa.supabase.co'
    const supabaseAnonKey = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImVmbnptcHpremV1a3Rxa2dod2ZhIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTYyMzE4MzcsImV4cCI6MjA3MTgwNzgzN30.iQiDuurPIkSNjHWP6TID0dATrOCJQ71-kblcsRsHiAk'
    
    const supabase = createClient(supabaseUrl, supabaseAnonKey)
    
    window.testAdminAccess = async () => {
      console.log('üîç === TEST ACC√àS ADMIN ===\n')
      
      // Test 1: Session actuelle
      console.log('1Ô∏è‚É£ V√©rification de la session...')
      const { data: { session }, error: sessionError } = await supabase.auth.getSession()
      console.log('   Session:', session)
      console.log('   Error:', sessionError)
      
      if (!session || sessionError) {
        console.log('   ‚ùå Pas de session active')
        console.log('   ‚û°Ô∏è Solution: Connectez-vous d\'abord sur /login')
        return
      }
      
      console.log('   ‚úÖ Session active')
      console.log('   User ID:', session.user.id)
      console.log('   Email:', session.user.email)
      
      // Test 2: Table admins
      console.log('\n2Ô∏è‚É£ V√©rification table admins...')
      const { data: adminsData, error: adminsError } = await supabase
        .from('admins')
        .select('*')
      
      console.log('   Data:', adminsData)
      console.log('   Error:', adminsError)
      
      if (adminsError) {
        console.log('   ‚ùå Erreur acc√®s table admins')
        console.log('   Code:', adminsError.code)
        console.log('   Message:', adminsError.message)
        console.log('   ‚û°Ô∏è Solution: V√©rifier que la table admins existe dans Supabase')
        return
      }
      
      console.log('   ‚úÖ Table admins accessible')
      console.log('   Nombre d\'admins:', adminsData?.length || 0)
      
      // Test 3: Statut admin de l'utilisateur
      console.log('\n3Ô∏è‚É£ V√©rification si utilisateur est admin...')
      const { data: userAdmin, error: userAdminError } = await supabase
        .from('admins')
        .select('user_id')
        .eq('user_id', session.user.id)
        .single()
      
      console.log('   User Admin Data:', userAdmin)
      console.log('   Error:', userAdminError)
      
      if (userAdminError || !userAdmin) {
        console.log('   ‚ùå Utilisateur NON admin')
        console.log('   ‚û°Ô∏è Solution: Ex√©cuter dans Supabase SQL:')
        console.log(`   INSERT INTO public.admins(user_id) VALUES ('${session.user.id}') ON CONFLICT (user_id) DO NOTHING;`)
        return
      }
      
      console.log('   ‚úÖ Utilisateur EST admin')
      
      // Test 4: RLS Policies
      console.log('\n4Ô∏è‚É£ Test des policies RLS...')
      const { data: songsData, error: songsError } = await supabase
        .from('songs')
        .select('id, title, status')
        .limit(5)
      
      console.log('   Songs Data:', songsData)
      console.log('   Error:', songsError)
      
      if (songsError) {
        console.log('   ‚ùå Erreur RLS policies')
        console.log('   Code:', songsError.code)
        console.log('   Message:', songsError.message)
        console.log('   ‚û°Ô∏è Solution: V√©rifier les policies RLS dans Supabase')
        return
      }
      
      console.log('   ‚úÖ RLS policies fonctionnent correctement')
      console.log('   Nombre de chansons:', songsData?.length || 0)
      
      console.log('\n‚úÖ Tous les tests pass√©s! Vous devriez pouvoir acc√©der √† /admin')
    }
    
    console.log('‚úÖ Script charg√©. Tapez testAdminAccess() dans la console pour lancer le test.')
    console.log('üîó Ou acc√©dez directement: https://www.amusicadasegunda.com/#/admin')
  </script>
</head>
<body style="font-family: Arial, sans-serif; padding: 20px; max-width: 800px; margin: 0 auto;">
  <h1>üîê Test Acc√®s Admin</h1>
  <p>Ouvrez la console du navigateur (F12) et tapez:</p>
  <pre style="background: #f0f0f0; padding: 10px; border-radius: 5px;">testAdminAccess()</pre>
  <hr>
  <h2>Instructions:</h2>
  <ol>
    <li>Ouvrez la console (F12)</li>
    <li>Tapez <code>testAdminAccess()</code></li>
    <li>Suivez les instructions dans la console</li>
  </ol>
  <hr>
  <p><strong>Lien admin:</strong> <a href="https://www.amusicadasegunda.com/#/admin">https://www.amusicadasegunda.com/#/admin</a></p>
</body>
</html>

