import{r as t,j as e,p as C,k as F}from"./vendor-react-CM84WoKi.js";import{n as w,aa as P,b2 as I,as as M,b3 as R}from"./vendor-ui-8p2QWU2G.js";import{B as j}from"./index-DEyKsSSU.js";import{I as S}from"./input--N8Qgu0x.js";import"./vendor-supabase-ci4wIQv9.js";import"./vendor-date-HUzpq8ep.js";function A({postId:o,controls:h=0,autoPlay:i=!0,className:k=""}){const a=t.useRef(null),n=t.useRef(null),[d,u]=t.useState(!0),[m,c]=t.useState(null),[f,g]=t.useState(!0),[l,T]=t.useState(!1),[p,y]=t.useState(!1),b=t.useCallback(s=>{if(s.origin!=="https://www.tiktok.com"){console.warn("TikTok player: message rejet√© depuis une origine non autoris√©e:",s.origin);return}try{const r=s.data;if(!r||typeof r!="object"||!r.event){console.warn("TikTok player: donn√©es de message invalides:",r);return}switch(r.event){case"onPlayerReady":console.log("TikTok player ready"),y(!0),u(!1);break;case"onStateChange":r.info===0&&(console.log("Video ended, restarting loop"),p&&(x("seekTo",0),setTimeout(()=>x("play"),100)));break;case"onMute":g(r.info===1);break;case"onError":console.error("TikTok player error:",r.info),c("Erro no player TikTok");break;default:console.debug("TikTok player: √©v√©nement non g√©r√©:",r.event)}}catch(r){console.warn("Error parsing TikTok message:",r)}},[p]),x=t.useCallback((s,r)=>{if(n.current&&p)try{n.current.contentWindow&&n.current.contentWindow.postMessage({method:s,value:r},"https://www.tiktok.com")}catch(v){v.name!=="SecurityError"&&console.error("TikTok player: erreur lors de l'envoi du message:",v)}},[p]),N=t.useCallback(()=>{if(g(!1),x("unMute"),x("seekTo",0),x("play"),n.current)try{n.current.contentWindow&&(n.current.contentWindow.postMessage({method:"unMute",value:0},"https://www.tiktok.com"),n.current.contentWindow.postMessage({method:"play",value:0},"https://www.tiktok.com"))}catch(s){s.name!=="SecurityError"&&console.log("Impossible de forcer la lecture avec son:",s)}},[x]),E=t.useCallback(()=>{l?document.exitFullscreen?document.exitFullscreen():document.webkitExitFullscreen&&document.webkitExitFullscreen():a.current?.requestFullscreen?a.current.requestFullscreen():a.current?.webkitRequestFullscreen&&a.current.webkitRequestFullscreen()},[l]);return t.useEffect(()=>{const s=()=>{T(!!document.fullscreenElement||!!document.webkitFullscreenElement)};return document.addEventListener("fullscreenchange",s),document.addEventListener("webkitfullscreenchange",s),()=>{document.removeEventListener("fullscreenchange",s),document.removeEventListener("webkitfullscreenchange",s)}},[]),t.useEffect(()=>(window.addEventListener("message",b),()=>window.removeEventListener("message",b)),[b]),t.useEffect(()=>{if(!o||!a.current)return;u(!0),c(null),y(!1),a.current.innerHTML="";const s=document.createElement("iframe");s.src=`https://www.tiktok.com/player/v1/${o}?autoplay=${i?1:0}&loop=1&controls=${h}&rel=0&muted=0&ratio=9:16`,s.title="TikTok Video Player",s.allowFullscreen=!0,s.allow="autoplay; fullscreen; picture-in-picture; clipboard-write; encrypted-media; gyroscope",s.style.cssText=`
      width: 100%;
      height: 100%;
      border: none;
      border-radius: 16px;
      background: #000;
      overflow: hidden;
      position: absolute;
      top: 0;
      left: 0;
      right: 0;
      bottom: 0;
      /* Forcer le format 9:16 et supprimer l'√©cran blanc */
      object-fit: cover;
      object-position: center;
    `,s.onload=()=>{console.log("TikTok iframe loaded")},s.onerror=()=>{console.error("TikTok iframe failed to load"),c("Erro ao carregar v√≠deo TikTok"),u(!1)},a.current.appendChild(s),n.current=s;const r=setTimeout(()=>{d&&!p&&(console.warn("TikTok player timeout"),c("Timeout ao carregar TikTok"),u(!1))},15e3);return()=>{clearTimeout(r),a.current&&(a.current.innerHTML="")}},[o,i,h]),o?e.jsxs("div",{ref:a,className:`tiktok-player-container ${k} ${l?"fullscreen":""}`,children:[d&&e.jsxs("div",{className:"tiktok-player-loading",children:[e.jsx("div",{className:"loading-spinner",children:e.jsx(P,{className:"w-8 h-8 animate-spin text-[#FF0050]"})}),e.jsx("p",{className:"loading-text",children:"Carregando TikTok..."})]}),m&&e.jsx("div",{className:"tiktok-player-error",children:e.jsxs("div",{className:"error-content",children:[e.jsx("div",{className:"error-icon",children:"‚ö†Ô∏è"}),e.jsx("h3",{className:"error-title",children:"Erro ao carregar"}),e.jsx("p",{className:"error-message",children:m}),e.jsx("div",{className:"error-actions",children:e.jsx("button",{onClick:()=>window.open(`https://www.tiktok.com/@user/video/${o}`,"_blank"),className:"fallback-link",children:"Abrir no TikTok"})})]})}),!d&&!m&&f&&e.jsx("div",{className:"tiktok-player-overlay",children:e.jsxs("button",{onClick:N,className:"unmute-button","aria-label":"Ativar o som e reproduzir v√≠deo","aria-pressed":"false",children:[e.jsx(I,{className:"w-6 h-6"}),e.jsx("span",{children:"Ativar Som"})]})}),!d&&!m&&e.jsx("button",{onClick:E,className:"fullscreen-button","aria-label":l?"Sair da tela cheia":"Tela cheia","aria-pressed":l,children:"‚õ∂"})]}):e.jsx("div",{className:`tiktok-player-fallback ${k}`,children:e.jsxs("div",{className:"fallback-content",children:[e.jsx(w,{className:"w-16 h-16 text-gray-400 mx-auto mb-4"}),e.jsx("h3",{className:"text-lg font-semibold text-gray-600 mb-2",children:"V√≠deo TikTok n√£o dispon√≠vel"}),e.jsx("p",{className:"text-gray-500 text-sm text-center",children:"ID da v√≠deo n√£o fornecido ou inv√°lido"})]})})}function B(){const{id:o}=C(),h=F(),[i,k]=t.useState(o||""),[a,n]=t.useState(0),[d,u]=t.useState(!0),m=o||"7467353900979424534",c=i||m,f=()=>{i.trim()&&h(`/tiktok/${i.trim()}`)},g=()=>{h("/")};return e.jsxs("div",{className:"min-h-screen bg-gradient-to-br from-teal-50 to-blue-100 p-4",children:[e.jsxs("div",{className:"max-w-4xl mx-auto mb-6",children:[e.jsxs("div",{className:"flex items-center gap-4 mb-4",children:[e.jsxs(j,{variant:"ghost",onClick:g,className:"text-gray-600 hover:text-gray-800",children:[e.jsx(M,{className:"w-5 h-5 mr-2"}),"Voltar"]}),e.jsxs("div",{className:"flex-1",children:[e.jsx("h1",{className:"text-2xl md:text-3xl font-black text-gray-800 mb-2",children:"TikTok Player Demo"}),e.jsx("p",{className:"text-gray-600",children:"Teste o player TikTok robusto com mobile-first, autoplay muted, e plein √©cran"})]})]}),e.jsxs("div",{className:"bg-white rounded-2xl p-6 shadow-lg",children:[e.jsxs("div",{className:"flex flex-col md:flex-row gap-4 items-end",children:[e.jsxs("div",{className:"flex-1",children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"ID da V√≠deo TikTok"}),e.jsx(S,{type:"text",value:i,onChange:l=>k(l.target.value),placeholder:"Ex: 7467353900979424534",className:"w-full"})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsxs(j,{onClick:f,disabled:!i.trim(),className:"bg-[#FF0050] hover:bg-[#E6004C] text-white",children:[e.jsx(w,{className:"w-4 h-4 mr-2"}),"Testar V√≠deo"]}),e.jsx(j,{variant:"outline",onClick:()=>k(m),className:"border-gray-300 text-gray-700",children:"Reset"})]})]}),e.jsx("div",{className:"mt-4 pt-4 border-t border-gray-200",children:e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsxs("label",{className:"flex items-center gap-2",children:[e.jsx("input",{type:"checkbox",checked:a===1,onChange:l=>n(l.target.checked?1:0),className:"rounded"}),e.jsx("span",{className:"text-sm text-gray-700",children:"Controles vis√≠veis"})]}),e.jsxs("label",{className:"flex items-center gap-2",children:[e.jsx("input",{type:"checkbox",checked:d,onChange:l=>u(l.target.checked),className:"rounded"}),e.jsx("span",{className:"text-sm text-gray-700",children:"Autoplay"})]})]})})]})]}),e.jsx("div",{className:"max-w-4xl mx-auto",children:e.jsxs("div",{className:"bg-white rounded-2xl shadow-lg p-6",children:[e.jsxs("div",{className:"mb-4",children:[e.jsxs("h2",{className:"text-lg font-semibold text-gray-800 mb-2",children:["Player TikTok - ",c]}),e.jsxs("p",{className:"text-sm text-gray-600",children:["ID atual: ",e.jsx("code",{className:"bg-gray-100 px-2 py-1 rounded",children:c})]})]}),e.jsx("div",{className:"relative w-full mx-auto",style:{maxWidth:"350px"},children:e.jsx("div",{style:{aspectRatio:"9/16"},children:e.jsx(A,{postId:c,controls:a,autoPlay:d,className:"w-full h-full"})})})]})}),e.jsx("div",{className:"max-w-4xl mx-auto mt-6",children:e.jsxs("div",{className:"bg-white rounded-2xl p-6 shadow-lg",children:[e.jsxs("h3",{className:"text-lg font-semibold text-gray-800 mb-4 flex items-center gap-2",children:[e.jsx(R,{className:"w-5 h-5"}),"Funcionalidades T√©cnicas"]}),e.jsxs("div",{className:"grid md:grid-cols-2 gap-4 text-sm",children:[e.jsxs("div",{children:[e.jsx("h4",{className:"font-medium text-gray-700 mb-2",children:"‚úÖ Implementado"}),e.jsxs("ul",{className:"space-y-1 text-gray-600",children:[e.jsx("li",{children:"‚Ä¢ Autoplay muted par d√©faut"}),e.jsx("li",{children:'‚Ä¢ Overlay "Activer le son" accessible'}),e.jsx("li",{children:"‚Ä¢ Loop automatique en fin de vid√©o"}),e.jsx("li",{children:"‚Ä¢ Plein √©cran mobile (100svh, safe-areas)"}),e.jsx("li",{children:"‚Ä¢ PostMessage API pour contr√¥ler la lecture"}),e.jsx("li",{children:"‚Ä¢ Fallback robuste en cas de blocage"}),e.jsx("li",{children:"‚Ä¢ Mobile-first responsive design"}),e.jsx("li",{children:"‚Ä¢ Accessibilit√© ARIA compl√®te"})]})]}),e.jsxs("div",{children:[e.jsx("h4",{className:"font-medium text-gray-700 mb-2",children:"üîß API TikTok v1"}),e.jsxs("ul",{className:"space-y-1 text-gray-600",children:[e.jsxs("li",{children:["‚Ä¢ URL: ",e.jsx("code",{className:"bg-gray-100 px-1 rounded",children:"/player/v1/&lbrace;ID&rbrace;"})]}),e.jsx("li",{children:"‚Ä¢ Param√®tres: autoplay, loop, controls, muted"}),e.jsx("li",{children:"‚Ä¢ PostMessage: onPlayerReady, onStateChange"}),e.jsx("li",{children:"‚Ä¢ Commands: play, pause, seekTo, unMute"})]})]})]})]})})]})}export{B as default};
