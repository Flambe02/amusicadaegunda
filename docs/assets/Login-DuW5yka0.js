import{r as i,j as e,H as P}from"./vendor-react-CM84WoKi.js";import{f as k,B as E,s as g}from"./index-DONdmDIg.js";import{I as S}from"./input-d5GtQV8D.js";import{C as N,c as A,a as I,b as $,d as F}from"./card-n_f6nzEY.js";import{aU as L,aV as G,aW as K,aX as r,aY as x,aZ as X,a_ as V,y as J,m as Q,as as D,M,ao as w,a$ as O,aq as ee,ar as se,ap as te,b0 as ae}from"./vendor-ui-8p2QWU2G.js";const pe=L({title:r().min(1,"O t√≠tulo √© obrigat√≥rio").max(200,"O t√≠tulo deve ter no m√°ximo 200 caracteres").trim(),artist:r().max(100,"O artista deve ter no m√°ximo 100 caracteres").trim().default("A M√∫sica da Segunda"),description:r().max(5e3,"A descri√ß√£o deve ter no m√°ximo 5000 caracteres").trim().optional().nullable(),release_date:r().regex(/^\d{4}-\d{2}-\d{2}$/,"Data inv√°lida. Use o formato YYYY-MM-DD").or(X()),tiktok_url:r().url("URL do TikTok inv√°lida").or(x("")).optional().nullable(),tiktok_video_id:r().regex(/^\d{15,20}$/,"ID do TikTok inv√°lido").or(x("")).optional().nullable(),youtube_url:r().url("URL do YouTube inv√°lida").or(x("")).optional().nullable(),youtube_music_url:r().url("URL do YouTube Music inv√°lida").or(x("")).optional().nullable(),spotify_url:r().url("URL do Spotify inv√°lida").or(x("")).optional().nullable(),apple_music_url:r().url("URL do Apple Music inv√°lida").or(x("")).optional().nullable(),lyrics:r().max(1e4,"As letras devem ter no m√°ximo 10000 caracteres").trim().optional().nullable(),hashtags:K(r().max(50).trim()).max(20,"M√°ximo de 20 hashtags").optional().default([]),status:G(["draft","published","archived"]).default("draft")}),re=L({email:r().email("Email inv√°lido").min(1,"O email √© obrigat√≥rio").max(255,"Email muito longo"),password:r().min(6,"A senha deve ter no m√≠nimo 6 caracteres").max(100,"Senha muito longa")});L({query:r().max(100,"A busca deve ter no m√°ximo 100 caracteres").trim()});r().refine(s=>!s||s.trim()===""?!0:[/tiktok\.com\/@[^/]+\/video\/\d+/,/vm\.tiktok\.com\/[A-Za-z0-9]+/,/^\d{15,20}$/].some(t=>t.test(s)),{message:"URL do TikTok inv√°lida. Use: https://www.tiktok.com/@usuario/video/ID ou https://vm.tiktok.com/ID"});r().refine(s=>!s||s.trim()===""?!0:[/(?:youtube\.com|youtu\.be)\/.+/,/^[A-Za-z0-9_-]{11}$/].some(t=>t.test(s)),{message:"URL do YouTube inv√°lida"});function ie(s,a){const t=s.safeParse(a);return t.success?{success:!0,data:t.data}:{success:!1,error:t.error.errors.map(c=>`${c.path.join(".")}: ${c.message}`).join(", ")}}function U(s,a={}){if(!s||typeof s!="string")return"";const t={ALLOWED_TAGS:[],ALLOWED_ATTR:[],KEEP_CONTENT:!0};return V.sanitize(s,{...t,...a})}function be(s){if(!s||typeof s!="string")return"";const a=V.sanitize(s,{ALLOWED_TAGS:[],ALLOWED_ATTR:[]});try{const t=new URL(a);return["http:","https:","mailto:"].includes(t.protocol)?a:""}catch{return""}}const ne=J("relative w-full rounded-lg border px-4 py-3 text-sm [&>svg+div]:translate-y-[-3px] [&>svg]:absolute [&>svg]:left-4 [&>svg]:top-4 [&>svg]:text-foreground [&>svg~*]:pl-7",{variants:{variant:{default:"bg-background text-foreground",destructive:"border-destructive/50 text-destructive dark:border-destructive [&>svg]:text-destructive"}},defaultVariants:{variant:"default"}}),T=i.forwardRef(({className:s,variant:a,...t},o)=>e.jsx("div",{ref:o,role:"alert",className:k(ne({variant:a}),s),...t}));T.displayName="Alert";const le=i.forwardRef(({className:s,...a},t)=>e.jsx("h5",{ref:t,className:k("mb-1 font-medium leading-none tracking-tight",s),...a}));le.displayName="AlertTitle";const C=i.forwardRef(({className:s,...a},t)=>e.jsx("div",{ref:t,className:k("text-sm [&_p]:leading-relaxed",s),...a}));C.displayName="AlertDescription";function oe({onBackToLogin:s}){const[a,t]=i.useState(""),[o,c]=i.useState(!1),[h,l]=i.useState({type:"",text:""}),[f,j]=i.useState(!1),d=async p=>{p.preventDefault(),c(!0),l({type:"",text:""});try{const{error:m}=await g.auth.resetPasswordForEmail(a.trim(),{redirectTo:"https://www.amusicadasegunda.com/#/admin"});if(m)throw m;j(!0),l({type:"success",text:"Email de r√©initialisation envoy√© ! V√©rifiez votre bo√Æte de r√©ception."})}catch(m){console.error("Erreur reset password:",m),l({type:"error",text:`Erreur: ${m.message}`})}finally{c(!1)}};return f?e.jsx("div",{className:"min-h-screen bg-gradient-to-br from-blue-50 to-indigo-100 flex items-center justify-center p-4",children:e.jsx(N,{className:"w-full max-w-md",children:e.jsx(A,{className:"pt-6",children:e.jsxs("div",{className:"text-center",children:[e.jsx(Q,{className:"w-12 h-12 text-green-600 mx-auto mb-4"}),e.jsx("h2",{className:"text-xl font-semibold text-green-800 mb-2",children:"Email Envoy√© !"}),e.jsx("p",{className:"text-gray-600 mb-4",children:"V√©rifiez votre bo√Æte de r√©ception et suivez les instructions pour r√©initialiser votre mot de passe."}),e.jsxs(E,{onClick:s,variant:"outline",className:"w-full",children:[e.jsx(D,{className:"w-4 h-4 mr-2"}),"Retour √† la connexion"]})]})})})}):e.jsx("div",{className:"min-h-screen bg-gradient-to-br from-blue-50 to-indigo-100 flex items-center justify-center p-4",children:e.jsxs(N,{className:"w-full max-w-md",children:[e.jsxs(I,{className:"text-center",children:[e.jsx("div",{className:"mx-auto w-12 h-12 bg-blue-100 rounded-full flex items-center justify-center mb-4",children:e.jsx(M,{className:"w-6 h-6 text-blue-600"})}),e.jsx($,{className:"text-2xl font-bold text-gray-900",children:"R√©initialiser le mot de passe"}),e.jsx(F,{children:"Entrez votre email pour recevoir un lien de r√©initialisation"})]}),e.jsxs(A,{children:[e.jsxs("form",{onSubmit:d,className:"space-y-4",children:[h.text&&e.jsx(T,{variant:h.type==="error"?"destructive":"default",children:e.jsx(C,{children:h.text})}),e.jsxs("div",{className:"space-y-2",children:[e.jsx("label",{htmlFor:"email",className:"text-sm font-medium text-gray-700",children:"Email"}),e.jsx(S,{id:"email",type:"email",placeholder:"admin@amusicadasegunda.com",value:a,onChange:p=>t(p.target.value),required:!0,disabled:o,className:"w-full"})]}),e.jsx(E,{type:"submit",className:"w-full bg-blue-600 hover:bg-blue-700 text-white",disabled:o,children:o?e.jsxs(e.Fragment,{children:[e.jsx(w,{className:"w-4 h-4 animate-spin mr-2"}),"Envoi en cours..."]}):e.jsxs(e.Fragment,{children:[e.jsx(M,{className:"w-4 h-4 mr-2"}),"Envoyer le lien"]})})]}),e.jsx("div",{className:"mt-6 text-center",children:e.jsxs("button",{onClick:s,className:"text-blue-600 hover:text-blue-700 font-medium",disabled:o,children:[e.jsx(D,{className:"w-4 h-4 inline mr-1"}),"Retour √† la connexion"]})}),e.jsx("div",{className:"mt-4 p-3 bg-blue-50 rounded-lg",children:e.jsx("p",{className:"text-xs text-blue-800 text-center",children:"üí° Le lien de r√©initialisation sera envoy√© √† l'adresse email fournie"})})]})]})})}function ce(){const[s,a]=i.useState(""),[t,o]=i.useState(""),[c,h]=i.useState(!1),[l,f]=i.useState(!1),[j,d]=i.useState(""),[p,m]=i.useState(!1),[Y,q]=i.useState(!0),[W,R]=i.useState(!1);i.useEffect(()=>{B()},[]);const B=async()=>{try{const{data:{session:n}}=await g.auth.getSession();n&&(await _(n.user.id)?(m(!0),setTimeout(()=>{window.location.href="/admin"},1e3)):d("‚ùå Vous n'avez pas les droits d'administrateur"))}catch(n){console.error("Erreur v√©rification auth:",n)}finally{q(!1)}},_=async n=>{try{const{data:u,error:v}=await g.from("admins").select("user_id").eq("user_id",n).single();return v?(console.error("Erreur v√©rification admin:",v),!1):!!u}catch(u){return console.error("Erreur v√©rification admin:",u),!1}},H=async n=>{n.preventDefault(),f(!0),d("");const u=U(s.trim()),v=U(t),y=ie(re,{email:u,password:v});if(!y.success){d(y.error),f(!1);return}try{const{data:b,error:z}=await g.auth.signInWithPassword({email:y.data.email,password:y.data.password});if(z)throw z;b.user&&(await _(b.user.id)?(m(!0),window.location.href="/admin"):(await g.auth.signOut(),d("‚ùå Vous n'avez pas les droits d'administrateur. Contactez l'administrateur du syst√®me.")))}catch(b){console.error("Erreur de connexion:",b),d(`‚ùå Erreur de connexion: ${b.message}`)}finally{f(!1)}},Z=async()=>{d("‚ÑπÔ∏è Pour cr√©er un compte administrateur, contactez l'administrateur du syst√®me.")};return W?e.jsx(oe,{onBackToLogin:()=>R(!1)}):Y?e.jsxs("div",{className:"min-h-screen bg-gradient-to-br from-blue-50 to-indigo-100 flex items-center justify-center p-4",children:[e.jsx(P,{children:e.jsx("meta",{name:"robots",content:"noindex,nofollow"})}),e.jsxs("div",{className:"text-center",children:[e.jsx(w,{className:"w-8 h-8 animate-spin mx-auto mb-4 text-blue-600"}),e.jsx("p",{className:"text-gray-600",children:"V√©rification de l'authentification..."})]})]}):p?e.jsx("div",{className:"min-h-screen bg-gradient-to-br from-blue-50 to-indigo-100 flex items-center justify-center p-4",children:e.jsx(N,{className:"w-full max-w-md",children:e.jsx(A,{className:"pt-6",children:e.jsxs("div",{className:"text-center",children:[e.jsx(O,{className:"w-12 h-12 text-green-600 mx-auto mb-4"}),e.jsx("h2",{className:"text-xl font-semibold text-green-800 mb-2",children:"‚úÖ Authentifi√© avec succ√®s"}),e.jsx("p",{className:"text-gray-600 mb-4",children:"Redirection vers l'Admin en cours..."}),e.jsx(w,{className:"w-6 h-6 animate-spin mx-auto text-blue-600"})]})})})}):e.jsxs("div",{className:"min-h-screen bg-gradient-to-br from-blue-50 to-indigo-100 flex items-center justify-center p-4",children:[e.jsx(P,{children:e.jsx("meta",{name:"robots",content:"noindex,nofollow"})}),e.jsxs(N,{className:"w-full max-w-md",children:[e.jsxs(I,{className:"text-center",children:[e.jsx("div",{className:"mx-auto w-12 h-12 bg-blue-100 rounded-full flex items-center justify-center mb-4",children:e.jsx(O,{className:"w-6 h-6 text-blue-600"})}),e.jsx($,{className:"text-2xl font-bold text-gray-900",children:"Connexion Admin"}),e.jsx(F,{children:"Acc√®s r√©serv√© aux administrateurs de M√∫sica da Segunda"})]}),e.jsxs(A,{children:[e.jsxs("form",{onSubmit:H,className:"space-y-4",children:[j&&e.jsx(T,{variant:"destructive",children:e.jsx(C,{children:j})}),e.jsxs("div",{className:"space-y-2",children:[e.jsx("label",{htmlFor:"email",className:"text-sm font-medium text-gray-700",children:"Email"}),e.jsx(S,{id:"email",type:"email",placeholder:"admin@amusicadasegunda.com",value:s,onChange:n=>a(n.target.value),required:!0,disabled:l,className:"w-full"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx("label",{htmlFor:"password",className:"text-sm font-medium text-gray-700",children:"Mot de passe"}),e.jsxs("div",{className:"relative",children:[e.jsx(S,{id:"password",type:c?"text":"password",placeholder:"‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢",value:t,onChange:n=>o(n.target.value),required:!0,disabled:l,className:"w-full pr-10"}),e.jsx("button",{type:"button",onClick:()=>h(!c),className:"absolute right-3 top-1/2 transform -translate-y-1/2 text-gray-400 hover:text-gray-600",disabled:l,children:c?e.jsx(ee,{className:"w-4 h-4"}):e.jsx(se,{className:"w-4 h-4"})})]})]}),e.jsx(E,{type:"submit",className:"w-full bg-blue-600 hover:bg-blue-700 text-white",disabled:l,children:l?e.jsxs(e.Fragment,{children:[e.jsx(w,{className:"w-4 h-4 animate-spin mr-2"}),"Connexion..."]}):e.jsxs(e.Fragment,{children:[e.jsx(te,{className:"w-4 h-4 mr-2"}),"Se connecter"]})})]}),e.jsxs("div",{className:"mt-6 text-center space-y-2",children:[e.jsxs("p",{className:"text-sm text-gray-600",children:["Mot de passe oubli√© ?"," ",e.jsxs("button",{onClick:()=>R(!0),className:"text-blue-600 hover:text-blue-700 font-medium",disabled:l,children:[e.jsx(ae,{className:"w-4 h-4 inline mr-1"}),"R√©initialiser"]})]}),e.jsxs("p",{className:"text-sm text-gray-600",children:["Pas de compte ?"," ",e.jsx("button",{onClick:Z,className:"text-blue-600 hover:text-blue-700 font-medium",disabled:l,children:"Contacter l'administrateur"})]})]}),e.jsx("div",{className:"mt-4 p-3 bg-blue-50 rounded-lg",children:e.jsx("p",{className:"text-xs text-blue-800 text-center",children:"üîí Cette page est prot√©g√©e. Seuls les administrateurs autoris√©s peuvent y acc√©der."})})]})]})]})}const ge=Object.freeze(Object.defineProperty({__proto__:null,default:ce},Symbol.toStringTag,{value:"Module"}));export{T as A,ce as L,U as a,ie as b,pe as c,C as d,ge as e,be as s};
