import{r,j as e}from"./vendor-react-NAV4UYoK.js";import{S as K,B as N}from"./index-Eb9Dd42K.js";import{Y as Q,Z as U,P as ee,n as te,a9 as se,aa as oe}from"./vendor-ui-BUbFcrva.js";import"./vendor-supabase-CMR6_zzL.js";import"./vendor-date-BfA9-vu0.js";const ae=["Janeiro","Fevereiro","MarÃ§o","Abril","Maio","Junho","Julho","Agosto","Setembro","Outubro","Novembro","Dezembro"],le=["#3B82F6","#6366F1","#EC4899","#F97316","#10B981","#EAB308","#F59E0B","#EF4444","#8B5CF6","#14B8A6","#06B6D4","#F43F5E"];function re(n){return n?n.toLowerCase().normalize("NFD").replace(/[\u0300-\u036f]/g,"").replace(/[^\w\s-]/g,"").replace(/\s+/g,"-").replace(/-+/g,"-").trim():null}function ne(n){if(!n)return null;const h=[/(?:youtube\.com\/watch\?v=|youtu\.be\/|youtube-nocookie\.com\/embed\/|music\.youtube\.com\/watch\?v=)([a-zA-Z0-9_-]{11})/,/youtube\.com\/shorts\/([a-zA-Z0-9_-]{11})/];for(const x of h){const s=n.match(x);if(s)return s[1]}return null}function Y(n,h,x){if(!n||h.length===0)return;const s=n.getContext("2d"),i=n.width,o=i/2,t=o-8,u=2*Math.PI/h.length;s.clearRect(0,0,i,i),s.save(),s.shadowColor="rgba(0,0,0,0.2)",s.shadowBlur=20,s.beginPath(),s.arc(o,o,t,0,2*Math.PI),s.fillStyle="#fff",s.fill(),s.restore(),h.forEach(({label:f,color:m},g)=>{const c=x+g*u,v=c+u,p=s.createRadialGradient(o,o,t*.25,o,o,t);p.addColorStop(0,m+"dd"),p.addColorStop(1,m),s.beginPath(),s.moveTo(o,o),s.arc(o,o,t,c,v),s.closePath(),s.fillStyle=p,s.fill(),s.strokeStyle="rgba(255,255,255,0.55)",s.lineWidth=1.5,s.stroke(),s.save(),s.translate(o,o),s.rotate(c+u/2),s.textAlign="center",s.fillStyle="#fff",s.font="bold 13px system-ui, sans-serif",s.shadowColor="rgba(0,0,0,0.55)",s.shadowBlur=4,s.fillText(f,t*.65,5),s.restore()}),s.beginPath(),s.arc(o,o,30,0,2*Math.PI),s.fillStyle="#fff",s.fill(),s.strokeStyle="#ddd",s.lineWidth=2,s.stroke(),s.fillStyle="#32a2dc",s.font="18px system-ui",s.textAlign="center",s.textBaseline="middle",s.fillText("ðŸŽµ",o,o)}function xe(){var _,R,B,A,F,E,I,T,O;const[n,h]=r.useState([]),[x,s]=r.useState(!0),[i,o]=r.useState(!1),[t,u]=r.useState(null),[f,m]=r.useState("stopped"),g=r.useRef(null),c=r.useRef(0),v=r.useRef(null),p=r.useRef(null),w=360,C=r.useMemo(()=>{const a={};return n.forEach(l=>{if(l.release_date){const d=new Date(l.release_date).getMonth();a[d]||(a[d]=[]),a[d].push(l)}}),a},[n]),b=r.useMemo(()=>ae.map((a,l)=>({label:a.slice(0,3),fullName:a,color:le[l],monthIndex:l,count:(C[l]||[]).length})),[C]);r.useEffect(()=>{K.list("-release_date").then(a=>{h(a||[]),s(!1)})},[]),r.useEffect(()=>{b.length>0&&Y(g.current,b,c.current)},[b]);const k=()=>{if(i||x)return;u(null),o(!0);const a=b.filter(j=>j.count>0);if(a.length===0){o(!1);return}const l=a[Math.floor(Math.random()*a.length)],d=2*Math.PI/12;let M=-Math.PI/2-l.monthIndex*d-d/2-c.current%(2*Math.PI);M<=0&&(M+=2*Math.PI);const D=c.current+(6+Math.floor(Math.random()*4))*2*Math.PI+M,H=4500,z=c.current,$=performance.now(),X=j=>1-Math.pow(1-j,4),G=j=>{const W=Math.min((j-$)/H,1);if(c.current=z+(D-z)*X(W),Y(g.current,b,c.current),W<1)v.current=requestAnimationFrame(G);else{c.current=D;const L=C[l.monthIndex]||[],V=L[Math.floor(Math.random()*L.length)];if(!V){u(null),o(!1);return}u({monthName:l.fullName,monthColor:l.color,song:V}),o(!1)}};v.current=requestAnimationFrame(G)},y=t!=null&&t.song?ne(t.song.youtube_url):null,P=(_=t==null?void 0:t.song)!=null&&_.title?re(t.song.title):null;r.useEffect(()=>{m(y?"playing":"stopped")},[y]);const S=a=>{var l,d;(d=(l=p.current)==null?void 0:l.contentWindow)==null||d.postMessage(JSON.stringify({event:"command",func:a,args:[]}),"*")},J=()=>{S("playVideo"),m("playing")},Z=()=>{S("pauseVideo"),m("paused")},q=()=>{S("stopVideo"),m("stopped")};return e.jsxs("div",{className:"min-h-screen bg-gradient-to-b from-sky-50 via-white to-blue-50",children:[e.jsxs("div",{className:"text-center pt-6 pb-4 px-4",children:[e.jsx("h1",{className:"text-3xl font-black text-gray-800 tracking-tight",children:"A Roda de Segunda"}),e.jsx("p",{className:"text-gray-500 mt-1 text-sm",children:"Gire a roda â€” cada mÃªs esconde uma mÃºsica!"})]}),e.jsxs("div",{className:"max-w-5xl mx-auto px-4 pb-16 flex flex-col lg:flex-row lg:items-start lg:gap-12",children:[e.jsxs("div",{className:"flex flex-col items-center flex-shrink-0",children:[e.jsxs("div",{className:"relative",style:{width:w},children:[e.jsx("div",{className:"absolute z-10",style:{top:-14,left:"50%",transform:"translateX(-50%)"},children:e.jsx("svg",{width:"28",height:"22",viewBox:"0 0 28 22",children:e.jsx("polygon",{points:"14,20 2,0 26,0",fill:"#1a1a2e",stroke:"white",strokeWidth:"2"})})}),e.jsx("canvas",{ref:g,width:w,height:w,className:"cursor-pointer rounded-full",style:{touchAction:"manipulation"},onClick:k})]}),e.jsx(N,{onClick:k,disabled:i||x,className:"mt-5 px-10 py-3 bg-[#32a2dc] hover:bg-[#2891c8] text-white font-black rounded-2xl text-lg shadow-lg transition-all hover:scale-105 disabled:opacity-60 disabled:scale-100",children:x?"Carregando...":i?"â³ Girando...":"Girar a Roda!"})]}),e.jsxs("div",{className:"flex-1 mt-8 lg:mt-0",children:[!t&&!i&&e.jsxs("div",{className:"hidden lg:flex flex-col items-center justify-center h-72 rounded-3xl border-2 border-dashed border-gray-200 text-gray-300",children:[e.jsx("div",{className:"text-5xl mb-3",children:"ðŸŽ¡"}),e.jsx("p",{className:"text-base font-medium",children:"Gire a roda para descobrir uma mÃºsica!"})]}),t&&!i&&e.jsxs("div",{className:"bg-white rounded-3xl shadow-xl overflow-hidden border-t-4",style:{borderColor:t.monthColor},children:[e.jsxs("div",{className:"px-6 py-4 text-white",style:{backgroundColor:t.monthColor},children:[e.jsx("p",{className:"text-xs font-bold uppercase tracking-widest opacity-80",children:"MÃªs sorteado"}),e.jsx("h2",{className:"text-2xl font-black",children:t.monthName})]}),e.jsxs("div",{className:"px-6 py-5",children:[e.jsxs("div",{className:"flex items-center gap-3 mb-4",children:[e.jsx("div",{className:"w-12 h-12 rounded-2xl flex items-center justify-center flex-shrink-0",style:{backgroundColor:t.monthColor+"22"},children:e.jsx(Q,{className:"w-6 h-6",style:{color:t.monthColor}})}),e.jsxs("div",{className:"min-w-0 flex-1",children:[e.jsx("p",{className:"text-xs text-gray-400 uppercase tracking-widest font-semibold",children:"MÃºsica sorteada"}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("h3",{className:"text-xl font-black text-gray-800 truncate",children:(R=t.song)==null?void 0:R.title}),P&&e.jsx("a",{href:`/musica/${P}/`,title:"Ver pÃ¡gina da mÃºsica",className:"flex-shrink-0 w-8 h-8 rounded-full flex items-center justify-center transition-all hover:scale-110 border-2",style:{borderColor:t.monthColor,color:t.monthColor,backgroundColor:"#fff"},children:e.jsx(U,{className:"w-4 h-4"})})]}),((B=t==null?void 0:t.song)==null?void 0:B.artist)&&e.jsx("p",{className:"text-gray-500 text-sm",children:t.song.artist}),((A=t==null?void 0:t.song)==null?void 0:A.release_date)&&e.jsxs("p",{className:"text-xs font-medium mt-0.5",style:{color:t.monthColor+"bb"},children:["ðŸ“… ",new Date(t.song.release_date+"T12:00:00").toLocaleDateString("pt-BR",{day:"numeric",month:"long",year:"numeric"})]})]})]}),!y&&((F=t==null?void 0:t.song)==null?void 0:F.youtube_url)&&e.jsxs("div",{className:"flex items-center gap-2 rounded-2xl px-4 py-3 mb-4 text-sm text-gray-500",style:{backgroundColor:"#f3f4f6"},children:[e.jsx("span",{children:"âš ï¸"}),e.jsx("span",{children:"Player indisponÃ­vel para esta mÃºsica â€” usa o botÃ£o YouTube abaixo."})]}),y&&e.jsxs(e.Fragment,{children:[e.jsx("iframe",{ref:p,src:`https://www.youtube-nocookie.com/embed/${y}?enablejsapi=1&autoplay=1&rel=0`,title:(E=t.song)==null?void 0:E.title,allow:"accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture",style:{position:"fixed",top:"-9999px",left:"-9999px",width:"1px",height:"1px",opacity:0,pointerEvents:"none"}}),e.jsxs("div",{className:"flex items-center gap-3 rounded-2xl px-4 py-3 mb-4",style:{backgroundColor:t.monthColor+"15"},children:[e.jsx("button",{onClick:f==="playing"?Z:J,className:"w-10 h-10 rounded-full flex items-center justify-center text-white shadow-md flex-shrink-0 transition-all hover:scale-110",style:{backgroundColor:t.monthColor},"aria-label":f==="playing"?"Pausar":"Tocar",children:f==="playing"?e.jsx(ee,{className:"w-4 h-4"}):e.jsx(te,{className:"w-4 h-4 ml-0.5"})}),e.jsx("button",{onClick:q,className:"w-8 h-8 rounded-full flex items-center justify-center border-2 flex-shrink-0 transition-all hover:scale-110",style:{borderColor:t.monthColor,color:t.monthColor,backgroundColor:"#fff"},"aria-label":"Parar",children:e.jsx(se,{className:"w-3 h-3"})}),e.jsx("span",{className:"text-sm font-semibold flex-1 truncate",style:{color:t.monthColor},children:f==="playing"?"â–¶ A tocar...":f==="paused"?"â¸ Pausado":"â¹ Parado"})]})]}),e.jsxs("div",{className:"flex flex-col gap-2",children:[((I=t.song)==null?void 0:I.spotify_url)&&e.jsx("a",{href:t.song.spotify_url,target:"_blank",rel:"noopener noreferrer",className:"block",children:e.jsx(N,{className:"w-full bg-[#1DB954] hover:bg-[#1ed760] text-white font-bold py-3 rounded-2xl text-sm transition-all hover:scale-105",children:"ðŸŽ§ Ouvir no Spotify"})}),((T=t.song)==null?void 0:T.youtube_url)&&e.jsx("a",{href:t.song.youtube_url,target:"_blank",rel:"noopener noreferrer",className:"block",children:e.jsx(N,{className:"w-full bg-[#FF0000] hover:bg-[#cc0000] text-white font-bold py-3 rounded-2xl text-sm transition-all hover:scale-105",children:"ðŸ“º Ouvir no YouTube"})}),((O=t.song)==null?void 0:O.apple_music_url)&&e.jsx("a",{href:t.song.apple_music_url,target:"_blank",rel:"noopener noreferrer",className:"block",children:e.jsx(N,{className:"w-full bg-gradient-to-r from-[#FA233B] to-[#FB5C74] hover:opacity-90 text-white font-bold py-3 rounded-2xl text-sm transition-all hover:scale-105",children:"ðŸŽµ Ouvir no Apple Music"})}),e.jsxs(N,{variant:"outline",onClick:()=>{u(null),k()},className:"w-full font-bold py-3 rounded-2xl text-sm gap-2 mt-1 border-2",style:{borderColor:t.monthColor,color:t.monthColor},children:[e.jsx(oe,{className:"w-4 h-4"}),"Girar de novo!"]})]})]})]})]})]})]})}export{xe as default};
