var te=Object.defineProperty;var A=Object.getOwnPropertySymbols;var I=Object.prototype.hasOwnProperty,$=Object.prototype.propertyIsEnumerable;var U=(s,a,t)=>a in s?te(s,a,{enumerable:!0,configurable:!0,writable:!0,value:t}):s[a]=t,p=(s,a)=>{for(var t in a||(a={}))I.call(a,t)&&U(s,t,a[t]);if(A)for(var t of A(a))$.call(a,t)&&U(s,t,a[t]);return s};var E=(s,a)=>{var t={};for(var r in s)I.call(s,r)&&a.indexOf(r)<0&&(t[r]=s[r]);if(s!=null&&A)for(var r of A(s))a.indexOf(r)<0&&$.call(s,r)&&(t[r]=s[r]);return t};var b=(s,a,t)=>new Promise((r,i)=>{var u=c=>{try{x(t.next(c))}catch(d){i(d)}},o=c=>{try{x(t.throw(c))}catch(d){i(d)}},x=c=>c.done?r(c.value):Promise.resolve(c.value).then(u,o);x((t=t.apply(s,a)).next())});import{r as l,j as e,H as F}from"./vendor-react-NAV4UYoK.js";import{e as R,B as T,s as y}from"./index-exKZPTCH.js";import{I as C}from"./input-DsqjENIN.js";import{C as k,c as L,a as B,b as H,d as Z}from"./card-BrMkQPzo.js";import{aU as _,aV as ae,aW as re,aX as n,aY as g,aZ as ie,a_ as G,y as ne,m as le,as as V,M as Y,ao as S,a$ as q,aq as oe,ar as ce,ap as de,b0 as me}from"./vendor-ui-BUbFcrva.js";const Ee=_({title:n().min(1,"O t√≠tulo √© obrigat√≥rio").max(200,"O t√≠tulo deve ter no m√°ximo 200 caracteres").trim(),artist:n().max(100,"O artista deve ter no m√°ximo 100 caracteres").trim().default("A M√∫sica da Segunda"),description:n().max(5e3,"A descri√ß√£o deve ter no m√°ximo 5000 caracteres").trim().optional().nullable(),release_date:n().regex(/^\d{4}-\d{2}-\d{2}$/,"Data inv√°lida. Use o formato YYYY-MM-DD").or(ie()),tiktok_url:n().url("URL do TikTok inv√°lida").or(g("")).optional().nullable(),tiktok_video_id:n().regex(/^\d{15,20}$/,"ID do TikTok inv√°lido").or(g("")).optional().nullable(),youtube_url:n().url("URL do YouTube inv√°lida").or(g("")).optional().nullable(),youtube_music_url:n().url("URL do YouTube Music inv√°lida").or(g("")).optional().nullable(),spotify_url:n().url("URL do Spotify inv√°lida").or(g("")).optional().nullable(),apple_music_url:n().url("URL do Apple Music inv√°lida").or(g("")).optional().nullable(),lyrics:n().max(1e4,"As letras devem ter no m√°ximo 10000 caracteres").trim().optional().nullable(),hashtags:re(n().max(50).trim()).max(20,"M√°ximo de 20 hashtags").optional().default([]),status:ae(["draft","published","archived"]).default("draft")}),ue=_({email:n().email("Email inv√°lido").min(1,"O email √© obrigat√≥rio").max(255,"Email muito longo"),password:n().min(6,"A senha deve ter no m√≠nimo 6 caracteres").max(100,"Senha muito longa")});_({query:n().max(100,"A busca deve ter no m√°ximo 100 caracteres").trim()});n().refine(s=>!s||s.trim()===""?!0:[/tiktok\.com\/@[^/]+\/video\/\d+/,/vm\.tiktok\.com\/[A-Za-z0-9]+/,/^\d{15,20}$/].some(t=>t.test(s)),{message:"URL do TikTok inv√°lida. Use: https://www.tiktok.com/@usuario/video/ID ou https://vm.tiktok.com/ID"});n().refine(s=>!s||s.trim()===""?!0:[/(?:youtube\.com|youtu\.be)\/.+/,/^[A-Za-z0-9_-]{11}$/].some(t=>t.test(s)),{message:"URL do YouTube inv√°lida"});function xe(s,a){const t=s.safeParse(a);return t.success?{success:!0,data:t.data}:{success:!1,error:t.error.errors.map(i=>`${i.path.join(".")}: ${i.message}`).join(", ")}}function W(s,a={}){if(!s||typeof s!="string")return"";const t={ALLOWED_TAGS:[],ALLOWED_ATTR:[],KEEP_CONTENT:!0};return G.sanitize(s,p(p({},t),a))}function Se(s){if(!s||typeof s!="string")return"";const a=G.sanitize(s,{ALLOWED_TAGS:[],ALLOWED_ATTR:[]});try{const t=new URL(a);return["http:","https:","mailto:"].includes(t.protocol)?a:""}catch(t){return""}}const he=ne("relative w-full rounded-lg border px-4 py-3 text-sm [&>svg+div]:translate-y-[-3px] [&>svg]:absolute [&>svg]:left-4 [&>svg]:top-4 [&>svg]:text-foreground [&>svg~*]:pl-7",{variants:{variant:{default:"bg-background text-foreground",destructive:"border-destructive/50 text-destructive dark:border-destructive [&>svg]:text-destructive"}},defaultVariants:{variant:"default"}}),z=l.forwardRef((i,r)=>{var u=i,{className:s,variant:a}=u,t=E(u,["className","variant"]);return e.jsx("div",p({ref:r,role:"alert",className:R(he({variant:a}),s)},t))});z.displayName="Alert";const fe=l.forwardRef((r,t)=>{var i=r,{className:s}=i,a=E(i,["className"]);return e.jsx("h5",p({ref:t,className:R("mb-1 font-medium leading-none tracking-tight",s)},a))});fe.displayName="AlertTitle";const P=l.forwardRef((r,t)=>{var i=r,{className:s}=i,a=E(i,["className"]);return e.jsx("div",p({ref:t,className:R("text-sm [&_p]:leading-relaxed",s)},a))});P.displayName="AlertDescription";function pe({onBackToLogin:s}){const[a,t]=l.useState(""),[r,i]=l.useState(!1),[u,o]=l.useState({type:"",text:""}),[x,c]=l.useState(!1),d=j=>b(null,null,function*(){j.preventDefault(),i(!0),o({type:"",text:""});try{const{error:h}=yield y.auth.resetPasswordForEmail(a.trim(),{redirectTo:"https://www.amusicadasegunda.com/#/admin"});if(h)throw h;c(!0),o({type:"success",text:"Email de r√©initialisation envoy√© ! V√©rifiez votre bo√Æte de r√©ception."})}catch(h){console.error("Erreur reset password:",h),o({type:"error",text:`Erreur: ${h.message}`})}finally{i(!1)}});return x?e.jsx("div",{className:"min-h-screen bg-gradient-to-br from-blue-50 to-indigo-100 flex items-center justify-center p-4",children:e.jsx(k,{className:"w-full max-w-md",children:e.jsx(L,{className:"pt-6",children:e.jsxs("div",{className:"text-center",children:[e.jsx(le,{className:"w-12 h-12 text-green-600 mx-auto mb-4"}),e.jsx("h2",{className:"text-xl font-semibold text-green-800 mb-2",children:"Email Envoy√© !"}),e.jsx("p",{className:"text-gray-600 mb-4",children:"V√©rifiez votre bo√Æte de r√©ception et suivez les instructions pour r√©initialiser votre mot de passe."}),e.jsxs(T,{onClick:s,variant:"outline",className:"w-full",children:[e.jsx(V,{className:"w-4 h-4 mr-2"}),"Retour √† la connexion"]})]})})})}):e.jsx("div",{className:"min-h-screen bg-gradient-to-br from-blue-50 to-indigo-100 flex items-center justify-center p-4",children:e.jsxs(k,{className:"w-full max-w-md",children:[e.jsxs(B,{className:"text-center",children:[e.jsx("div",{className:"mx-auto w-12 h-12 bg-blue-100 rounded-full flex items-center justify-center mb-4",children:e.jsx(Y,{className:"w-6 h-6 text-blue-600"})}),e.jsx(H,{className:"text-2xl font-bold text-gray-900",children:"R√©initialiser le mot de passe"}),e.jsx(Z,{children:"Entrez votre email pour recevoir un lien de r√©initialisation"})]}),e.jsxs(L,{children:[e.jsxs("form",{onSubmit:d,className:"space-y-4",children:[u.text&&e.jsx(z,{variant:u.type==="error"?"destructive":"default",children:e.jsx(P,{children:u.text})}),e.jsxs("div",{className:"space-y-2",children:[e.jsx("label",{htmlFor:"email",className:"text-sm font-medium text-gray-700",children:"Email"}),e.jsx(C,{id:"email",type:"email",placeholder:"admin@amusicadasegunda.com",value:a,onChange:j=>t(j.target.value),required:!0,disabled:r,className:"w-full"})]}),e.jsx(T,{type:"submit",className:"w-full bg-blue-600 hover:bg-blue-700 text-white",disabled:r,children:r?e.jsxs(e.Fragment,{children:[e.jsx(S,{className:"w-4 h-4 animate-spin mr-2"}),"Envoi en cours..."]}):e.jsxs(e.Fragment,{children:[e.jsx(Y,{className:"w-4 h-4 mr-2"}),"Envoyer le lien"]})})]}),e.jsx("div",{className:"mt-6 text-center",children:e.jsxs("button",{onClick:s,className:"text-blue-600 hover:text-blue-700 font-medium",disabled:r,children:[e.jsx(V,{className:"w-4 h-4 inline mr-1"}),"Retour √† la connexion"]})}),e.jsx("div",{className:"mt-4 p-3 bg-blue-50 rounded-lg",children:e.jsx("p",{className:"text-xs text-blue-800 text-center",children:"üí° Le lien de r√©initialisation sera envoy√© √† l'adresse email fournie"})})]})]})})}function be(){const[s,a]=l.useState(""),[t,r]=l.useState(""),[i,u]=l.useState(!1),[o,x]=l.useState(!1),[c,d]=l.useState(""),[j,h]=l.useState(!1),[K,X]=l.useState(!0),[J,D]=l.useState(!1);l.useEffect(()=>{Q()},[]);const Q=()=>b(null,null,function*(){try{const{data:{session:m}}=yield y.auth.getSession();m&&((yield M(m.user.id))?(h(!0),setTimeout(()=>{window.location.href="/admin"},1e3)):d("‚ùå Vous n'avez pas les droits d'administrateur"))}catch(m){console.error("Erreur v√©rification auth:",m)}finally{X(!1)}}),M=m=>b(null,null,function*(){try{const{data:f,error:w}=yield y.from("admins").select("user_id").eq("user_id",m).single();return w?(console.error("Erreur v√©rification admin:",w),!1):!!f}catch(f){return console.error("Erreur v√©rification admin:",f),!1}}),ee=m=>b(null,null,function*(){m.preventDefault(),x(!0),d("");const f=W(s.trim()),w=W(t),N=xe(ue,{email:f,password:w});if(!N.success){d(N.error),x(!1);return}try{const{data:v,error:O}=yield y.auth.signInWithPassword({email:N.data.email,password:N.data.password});if(O)throw O;v.user&&((yield M(v.user.id))?(h(!0),window.location.href="/admin"):(yield y.auth.signOut(),d("‚ùå Vous n'avez pas les droits d'administrateur. Contactez l'administrateur du syst√®me.")))}catch(v){console.error("Erreur de connexion:",v),d(`‚ùå Erreur de connexion: ${v.message}`)}finally{x(!1)}}),se=()=>b(null,null,function*(){d("‚ÑπÔ∏è Pour cr√©er un compte administrateur, contactez l'administrateur du syst√®me.")});return J?e.jsx(pe,{onBackToLogin:()=>D(!1)}):K?e.jsxs("div",{className:"min-h-screen bg-gradient-to-br from-blue-50 to-indigo-100 flex items-center justify-center p-4",children:[e.jsx(F,{children:e.jsx("meta",{name:"robots",content:"noindex,nofollow"})}),e.jsxs("div",{className:"text-center",children:[e.jsx(S,{className:"w-8 h-8 animate-spin mx-auto mb-4 text-blue-600"}),e.jsx("p",{className:"text-gray-600",children:"V√©rification de l'authentification..."})]})]}):j?e.jsx("div",{className:"min-h-screen bg-gradient-to-br from-blue-50 to-indigo-100 flex items-center justify-center p-4",children:e.jsx(k,{className:"w-full max-w-md",children:e.jsx(L,{className:"pt-6",children:e.jsxs("div",{className:"text-center",children:[e.jsx(q,{className:"w-12 h-12 text-green-600 mx-auto mb-4"}),e.jsx("h2",{className:"text-xl font-semibold text-green-800 mb-2",children:"‚úÖ Authentifi√© avec succ√®s"}),e.jsx("p",{className:"text-gray-600 mb-4",children:"Redirection vers l'Admin en cours..."}),e.jsx(S,{className:"w-6 h-6 animate-spin mx-auto text-blue-600"})]})})})}):e.jsxs("div",{className:"min-h-screen bg-gradient-to-br from-blue-50 to-indigo-100 flex items-center justify-center p-4",children:[e.jsx(F,{children:e.jsx("meta",{name:"robots",content:"noindex,nofollow"})}),e.jsxs(k,{className:"w-full max-w-md",children:[e.jsxs(B,{className:"text-center",children:[e.jsx("div",{className:"mx-auto w-12 h-12 bg-blue-100 rounded-full flex items-center justify-center mb-4",children:e.jsx(q,{className:"w-6 h-6 text-blue-600"})}),e.jsx(H,{className:"text-2xl font-bold text-gray-900",children:"Connexion Admin"}),e.jsx(Z,{children:"Acc√®s r√©serv√© aux administrateurs de M√∫sica da Segunda"})]}),e.jsxs(L,{children:[e.jsxs("form",{onSubmit:ee,className:"space-y-4",children:[c&&e.jsx(z,{variant:"destructive",children:e.jsx(P,{children:c})}),e.jsxs("div",{className:"space-y-2",children:[e.jsx("label",{htmlFor:"email",className:"text-sm font-medium text-gray-700",children:"Email"}),e.jsx(C,{id:"email",type:"email",placeholder:"admin@amusicadasegunda.com",value:s,onChange:m=>a(m.target.value),required:!0,disabled:o,className:"w-full"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx("label",{htmlFor:"password",className:"text-sm font-medium text-gray-700",children:"Mot de passe"}),e.jsxs("div",{className:"relative",children:[e.jsx(C,{id:"password",type:i?"text":"password",placeholder:"‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢",value:t,onChange:m=>r(m.target.value),required:!0,disabled:o,className:"w-full pr-10"}),e.jsx("button",{type:"button",onClick:()=>u(!i),className:"absolute right-3 top-1/2 transform -translate-y-1/2 text-gray-400 hover:text-gray-600",disabled:o,children:i?e.jsx(oe,{className:"w-4 h-4"}):e.jsx(ce,{className:"w-4 h-4"})})]})]}),e.jsx(T,{type:"submit",className:"w-full bg-blue-600 hover:bg-blue-700 text-white",disabled:o,children:o?e.jsxs(e.Fragment,{children:[e.jsx(S,{className:"w-4 h-4 animate-spin mr-2"}),"Connexion..."]}):e.jsxs(e.Fragment,{children:[e.jsx(de,{className:"w-4 h-4 mr-2"}),"Se connecter"]})})]}),e.jsxs("div",{className:"mt-6 text-center space-y-2",children:[e.jsxs("p",{className:"text-sm text-gray-600",children:["Mot de passe oubli√© ?"," ",e.jsxs("button",{onClick:()=>D(!0),className:"text-blue-600 hover:text-blue-700 font-medium",disabled:o,children:[e.jsx(me,{className:"w-4 h-4 inline mr-1"}),"R√©initialiser"]})]}),e.jsxs("p",{className:"text-sm text-gray-600",children:["Pas de compte ?"," ",e.jsx("button",{onClick:se,className:"text-blue-600 hover:text-blue-700 font-medium",disabled:o,children:"Contacter l'administrateur"})]})]}),e.jsx("div",{className:"mt-4 p-3 bg-blue-50 rounded-lg",children:e.jsx("p",{className:"text-xs text-blue-800 text-center",children:"üîí Cette page est prot√©g√©e. Seuls les administrateurs autoris√©s peuvent y acc√©der."})})]})]})]})}const ke=Object.freeze(Object.defineProperty({__proto__:null,default:be},Symbol.toStringTag,{value:"Module"}));export{z as A,be as L,W as a,xe as b,Ee as c,P as d,ke as e,Se as s};
