import{r as l,j as e,L as U}from"./vendor-react-CM84WoKi.js";import{S as ee,e as te,t as se,B as v,D as oe,a as ae,b as le,c as re}from"./index-qLA7x5O3.js";import{Y as ne,Z as ie,P as ce,n as de,a9 as ue,aa as me}from"./vendor-ui-8p2QWU2G.js";import"./vendor-supabase-ci4wIQv9.js";import"./vendor-date-HUzpq8ep.js";const he=["Janeiro","Fevereiro","Mar√ßo","Abril","Maio","Junho","Julho","Agosto","Setembro","Outubro","Novembro","Dezembro"],fe=["#3B82F6","#6366F1","#EC4899","#F97316","#10B981","#EAB308","#F59E0B","#EF4444","#8B5CF6","#14B8A6","#06B6D4","#F43F5E"];function J(g,y,j){if(!g||y.length===0)return;const s=g.getContext("2d"),c=g.width,o=c/2,t=o-8,d=2*Math.PI/y.length;s.clearRect(0,0,c,c),s.save(),s.shadowColor="rgba(0,0,0,0.2)",s.shadowBlur=20,s.beginPath(),s.arc(o,o,t,0,2*Math.PI),s.fillStyle="#fff",s.fill(),s.restore(),y.forEach(({label:m,color:i},C)=>{const b=j+C*d,R=b+d,h=s.createRadialGradient(o,o,t*.25,o,o,t);h.addColorStop(0,i+"dd"),h.addColorStop(1,i),s.beginPath(),s.moveTo(o,o),s.arc(o,o,t,b,R),s.closePath(),s.fillStyle=h,s.fill(),s.strokeStyle="rgba(255,255,255,0.55)",s.lineWidth=1.5,s.stroke(),s.save(),s.translate(o,o),s.rotate(b+d/2),s.textAlign="center",s.fillStyle="#fff",s.font="bold 13px system-ui, sans-serif",s.shadowColor="rgba(0,0,0,0.55)",s.shadowBlur=4,s.fillText(m,t*.65,5),s.restore()}),s.beginPath(),s.arc(o,o,30,0,2*Math.PI),s.fillStyle="#fff",s.fill(),s.strokeStyle="#ddd",s.lineWidth=2,s.stroke(),s.fillStyle="#32a2dc",s.font="18px system-ui",s.textAlign="center",s.textBaseline="middle",s.fillText("üéµ",o,o)}function je(){const[g,y]=l.useState([]),[j,s]=l.useState(!0),[c,o]=l.useState(!1),[t,d]=l.useState(null),[m,i]=l.useState("stopped"),[C,b]=l.useState(!1),[R,h]=l.useState(!1),P=l.useRef(null),f=l.useRef(0),T=l.useRef(null),B=l.useRef(null),x=l.useRef(null),k=l.useRef(!1),D=360,E=l.useMemo(()=>{const a={};return g.forEach(n=>{if(n.release_date){const r=new Date(n.release_date).getMonth();a[r]||(a[r]=[]),a[r].push(n)}}),a},[g]),N=l.useMemo(()=>he.map((a,n)=>({label:a.slice(0,3),fullName:a,color:fe[n],monthIndex:n,count:(E[n]||[]).length})),[E]);l.useEffect(()=>{ee.list("-release_date").then(a=>{y(a||[]),s(!1)})},[]),l.useEffect(()=>{N.length>0&&J(P.current,N,f.current)},[N]);const _=()=>{if(c||j)return;d(null),o(!0);const a=N.filter(w=>w.count>0);if(a.length===0){o(!1);return}const n=a[Math.floor(Math.random()*a.length)],r=2*Math.PI/12;let A=-Math.PI/2-n.monthIndex*r-r/2-f.current%(2*Math.PI);A<=0&&(A+=2*Math.PI);const I=f.current+(6+Math.floor(Math.random()*4))*2*Math.PI+A,X=4500,O=f.current,K=performance.now(),Q=w=>1-Math.pow(1-w,4),L=w=>{const V=Math.min((w-K)/X,1);if(f.current=O+(I-O)*Q(V),J(P.current,N,f.current),V<1)T.current=requestAnimationFrame(L);else{f.current=I;const W=E[n.monthIndex]||[],G=W[Math.floor(Math.random()*W.length)];if(!G){d(null),o(!1);return}d({monthName:n.fullName,monthColor:n.color,song:G}),o(!1)}};T.current=requestAnimationFrame(L)},u=t?.song?te(t.song.youtube_url):null,F=t?.song?.slug||(t?.song?.title?se(t.song.title):null),S=t?.song?.description?.trim()||"",Y=!!S,q=S.length>220,M=a=>{B.current?.contentWindow?.postMessage(JSON.stringify({event:"command",func:a,args:[]}),"*")},z=()=>{u&&M("playVideo")};l.useEffect(()=>{if(!u){i("stopped"),k.current=!1,x.current&&(clearTimeout(x.current),x.current=null);return}return i("playing"),k.current=!1,x.current=setTimeout(()=>{k.current||i("paused")},1500),()=>{x.current&&(clearTimeout(x.current),x.current=null)}},[u]),l.useEffect(()=>{b(!1),h(!1)},[t?.song?.id]),l.useEffect(()=>{if(!u)return;const a=n=>{if(n.source!==B.current?.contentWindow)return;let r=n.data;if(typeof r=="string")try{r=JSON.parse(r)}catch{return}if(!r||typeof r!="object")return;let p=null;r.event==="onStateChange"?p=r.info:r.event==="infoDelivery"&&r.info&&typeof r.info.playerState=="number"&&(p=r.info.playerState),typeof p=="number"&&(p===1?(k.current=!0,i("playing")):p===2?i("paused"):p===0&&i("stopped"))};return window.addEventListener("message",a),()=>window.removeEventListener("message",a)},[u]);const H=()=>{M("playVideo"),i("playing")},$=()=>{M("pauseVideo"),i("paused")},Z=()=>{M("stopVideo"),i("stopped")};return e.jsxs("div",{className:"min-h-screen bg-gradient-to-b from-sky-50 via-white to-blue-50",children:[e.jsxs("div",{className:"text-center pt-6 pb-4 px-4",children:[e.jsx("h1",{className:"text-3xl font-black text-gray-800 tracking-tight",children:"A Roda de Segunda"}),e.jsx("p",{className:"text-gray-500 mt-1 text-sm",children:"Gire a roda ‚Äî cada m√™s esconde uma m√∫sica!"})]}),e.jsxs("div",{className:"max-w-5xl mx-auto px-4 pb-16 flex flex-col lg:flex-row lg:items-start lg:gap-12",children:[e.jsxs("div",{className:"flex flex-col items-center flex-shrink-0",children:[e.jsxs("div",{className:"relative",style:{width:D},children:[e.jsx("div",{className:"absolute z-10",style:{top:-14,left:"50%",transform:"translateX(-50%)"},children:e.jsx("svg",{width:"28",height:"22",viewBox:"0 0 28 22",children:e.jsx("polygon",{points:"14,20 2,0 26,0",fill:"#1a1a2e",stroke:"white",strokeWidth:"2"})})}),e.jsx("canvas",{ref:P,width:D,height:D,className:"cursor-pointer rounded-full",style:{touchAction:"manipulation"},onClick:_})]}),e.jsx(v,{onClick:_,disabled:c||j,className:"mt-5 px-10 py-3 bg-[#32a2dc] hover:bg-[#2891c8] text-white font-black rounded-2xl text-lg shadow-lg transition-all hover:scale-105 disabled:opacity-60 disabled:scale-100",children:j?"Carregando...":c?"‚è≥ Girando...":"Girar a Roda!"})]}),e.jsxs("div",{className:"flex-1 mt-8 lg:mt-0",children:[!t&&!c&&e.jsxs("div",{className:"hidden lg:flex flex-col items-center justify-center h-72 rounded-3xl border-2 border-dashed border-gray-200 text-gray-300",children:[e.jsx("div",{className:"text-5xl mb-3",children:"üé°"}),e.jsx("p",{className:"text-base font-medium",children:"Gire a roda para descobrir uma m√∫sica!"})]}),t&&!c&&e.jsxs("div",{className:"bg-white rounded-3xl shadow-xl overflow-hidden border-t-4",style:{borderColor:t.monthColor},children:[e.jsxs("div",{className:"px-6 py-4 text-white",style:{backgroundColor:t.monthColor},children:[e.jsx("p",{className:"text-xs font-bold uppercase tracking-widest opacity-80",children:"M√™s sorteado"}),e.jsx("h2",{className:"text-2xl font-black",children:t.monthName})]}),e.jsxs("div",{className:"px-6 py-5",children:[e.jsxs("div",{className:"flex items-center gap-3 mb-4",children:[e.jsx("div",{className:"w-12 h-12 rounded-2xl flex items-center justify-center flex-shrink-0",style:{backgroundColor:t.monthColor+"22"},children:e.jsx(ne,{className:"w-6 h-6",style:{color:t.monthColor}})}),e.jsxs("div",{className:"min-w-0 flex-1",children:[e.jsx("p",{className:"text-xs text-gray-400 uppercase tracking-widest font-semibold",children:"M√∫sica sorteada"}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("h3",{className:"text-xl font-black text-gray-800 truncate",children:t.song?.title}),F&&e.jsx(U,{to:`/musica/${F}`,title:"Ver p√°gina da m√∫sica",className:"flex-shrink-0 w-8 h-8 rounded-full flex items-center justify-center transition-all hover:scale-110 border-2",style:{borderColor:t.monthColor,color:t.monthColor,backgroundColor:"#fff"},children:e.jsx(ie,{className:"w-4 h-4"})})]}),t?.song?.artist&&e.jsx("p",{className:"text-gray-500 text-sm",children:t.song.artist}),t?.song?.release_date&&e.jsxs("p",{className:"text-xs font-medium mt-0.5",style:{color:t.monthColor+"bb"},children:["üìÖ ",new Date(t.song.release_date+"T12:00:00").toLocaleDateString("pt-BR",{day:"numeric",month:"long",year:"numeric"})]})]})]}),!u&&t?.song?.youtube_url&&e.jsxs("div",{className:"flex items-center gap-2 rounded-2xl px-4 py-3 mb-4 text-sm text-gray-500",style:{backgroundColor:"#f3f4f6"},children:[e.jsx("span",{children:"‚ö†Ô∏è"}),e.jsx("span",{children:"Player indispon√≠vel para esta m√∫sica ‚Äî usa o bot√£o YouTube abaixo."})]}),u&&e.jsxs(e.Fragment,{children:[e.jsx("iframe",{ref:B,src:`https://www.youtube-nocookie.com/embed/${u}?enablejsapi=1&autoplay=1&rel=0`,title:t.song?.title,allow:"accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture",onLoad:z,style:{position:"fixed",top:"-9999px",left:"-9999px",width:"1px",height:"1px",opacity:0,pointerEvents:"none"}}),e.jsxs("div",{className:"flex items-center gap-3 rounded-2xl px-4 py-3 mb-4",style:{backgroundColor:t.monthColor+"15"},children:[e.jsx("button",{onClick:m==="playing"?$:H,className:"w-10 h-10 rounded-full flex items-center justify-center text-white shadow-md flex-shrink-0 transition-all hover:scale-110",style:{backgroundColor:t.monthColor},"aria-label":m==="playing"?"Pausar":"Tocar",children:m==="playing"?e.jsx(ce,{className:"w-4 h-4"}):e.jsx(de,{className:"w-4 h-4 ml-0.5"})}),e.jsx("button",{onClick:Z,className:"w-8 h-8 rounded-full flex items-center justify-center border-2 flex-shrink-0 transition-all hover:scale-110",style:{borderColor:t.monthColor,color:t.monthColor,backgroundColor:"#fff"},"aria-label":"Parar",children:e.jsx(ue,{className:"w-3 h-3"})}),e.jsx("span",{className:"text-sm font-semibold flex-1 truncate",style:{color:t.monthColor},children:m==="playing"?"‚ñ∂ A tocar...":m==="paused"?"‚è∏ Pausado":"‚èπ Parado"})]})]}),Y&&e.jsxs("div",{className:"rounded-2xl px-4 py-4 mb-4 border",style:{borderColor:t.monthColor+"33",backgroundColor:t.monthColor+"10"},children:[e.jsx("p",{className:"text-xs uppercase tracking-widest font-semibold mb-2",style:{color:t.monthColor},children:"Sobre esta m√∫sica"}),e.jsx("p",{className:`text-sm leading-relaxed text-gray-700 ${C?"":"line-clamp-2 md:line-clamp-3"}`,children:S}),q&&e.jsxs("div",{className:"flex items-center gap-2 mt-3",children:[e.jsx("button",{type:"button",onClick:()=>b(a=>!a),className:"text-sm font-semibold underline underline-offset-2",style:{color:t.monthColor},children:C?"Ver menos":"Ler mais"}),e.jsx("button",{type:"button",onClick:()=>h(!0),className:"hidden md:inline-block text-sm font-semibold underline underline-offset-2",style:{color:t.monthColor},children:"Abrir detalhes"})]})]}),e.jsxs("div",{className:"flex flex-col gap-2",children:[t.song?.spotify_url&&e.jsx("a",{href:t.song.spotify_url,target:"_blank",rel:"noopener noreferrer",className:"block",children:e.jsx(v,{className:"w-full bg-[#1DB954] hover:bg-[#1ed760] text-white font-bold py-3 rounded-2xl text-sm transition-all hover:scale-105",children:"üéß Ouvir no Spotify"})}),t.song?.youtube_url&&e.jsx("a",{href:t.song.youtube_url,target:"_blank",rel:"noopener noreferrer",className:"block",children:e.jsx(v,{className:"w-full bg-[#FF0000] hover:bg-[#cc0000] text-white font-bold py-3 rounded-2xl text-sm transition-all hover:scale-105",children:"üì∫ Ouvir no YouTube"})}),t.song?.apple_music_url&&e.jsx("a",{href:t.song.apple_music_url,target:"_blank",rel:"noopener noreferrer",className:"block",children:e.jsx(v,{className:"w-full bg-gradient-to-r from-[#FA233B] to-[#FB5C74] hover:opacity-90 text-white font-bold py-3 rounded-2xl text-sm transition-all hover:scale-105",children:"üéµ Ouvir no Apple Music"})}),e.jsxs(v,{variant:"outline",onClick:()=>{d(null),_()},className:"w-full font-bold py-3 rounded-2xl text-sm gap-2 mt-1 border-2",style:{borderColor:t.monthColor,color:t.monthColor},children:[e.jsx(me,{className:"w-4 h-4"}),"Girar de novo!"]})]})]})]})]})]}),e.jsx(oe,{open:R,onOpenChange:h,children:e.jsxs(ae,{className:"sm:max-w-lg",children:[e.jsx(le,{children:e.jsx(re,{children:"Sobre esta m√∫sica"})}),e.jsx("div",{className:"max-h-[60vh] overflow-y-auto pr-1",children:e.jsx("p",{className:"text-sm leading-relaxed text-gray-700 whitespace-pre-wrap",children:S||"Sem descri√ß√£o dispon√≠vel para esta m√∫sica."})})]})})]})}export{je as default};
