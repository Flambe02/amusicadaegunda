var e=Object.defineProperty,t=Object.getOwnPropertySymbols,s=Object.prototype.hasOwnProperty,a=Object.prototype.propertyIsEnumerable,r=(t,s,a)=>s in t?e(t,s,{enumerable:!0,configurable:!0,writable:!0,value:a}):t[s]=a,i=(e,i)=>{for(var l in i||(i={}))s.call(i,l)&&r(e,l,i[l]);if(t)for(var l of t(i))a.call(i,l)&&r(e,l,i[l]);return e},l=(e,r)=>{var i={};for(var l in e)s.call(e,l)&&r.indexOf(l)<0&&(i[l]=e[l]);if(null!=e&&t)for(var l of t(e))r.indexOf(l)<0&&a.call(e,l)&&(i[l]=e[l]);return i},n=(e,t,s)=>new Promise((a,r)=>{var i=e=>{try{n(s.next(e))}catch(t){r(t)}},l=e=>{try{n(s.throw(e))}catch(t){r(t)}},n=e=>e.done?a(e.value):Promise.resolve(e.value).then(i,l);n((s=s.apply(e,t)).next())});import{r as o,j as c,b as d,ad as m,an as u,aa as x,t as h,aG as f,ab as b,ac as p,U as v,aH as j}from"./vendor-BIbFW3qO.js";import{e as g,B as y,s as N}from"./index-DetkHvaz.js";import{I as w}from"./input-CnyY7bhd.js";import{C as k,c as S,a as A,b as E,d as T}from"./card-7icCX0xp.js";import{z as _,A as L,B as O,C as R,D as C,E as z,F as D,y as P}from"./libs-DY7TBn7z.js";const U=_({title:R().min(1,"O t√≠tulo √© obrigat√≥rio").max(200,"O t√≠tulo deve ter no m√°ximo 200 caracteres").trim(),artist:R().max(100,"O artista deve ter no m√°ximo 100 caracteres").trim().default("A M√∫sica da Segunda"),description:R().max(5e3,"A descri√ß√£o deve ter no m√°ximo 5000 caracteres").trim().optional().nullable(),release_date:R().regex(/^\d{4}-\d{2}-\d{2}$/,"Data inv√°lida. Use o formato YYYY-MM-DD").or(z()),tiktok_url:R().url("URL do TikTok inv√°lida").or(C("")).optional().nullable(),tiktok_video_id:R().regex(/^\d{15,20}$/,"ID do TikTok inv√°lido").or(C("")).optional().nullable(),youtube_url:R().url("URL do YouTube inv√°lida").or(C("")).optional().nullable(),youtube_music_url:R().url("URL do YouTube Music inv√°lida").or(C("")).optional().nullable(),spotify_url:R().url("URL do Spotify inv√°lida").or(C("")).optional().nullable(),apple_music_url:R().url("URL do Apple Music inv√°lida").or(C("")).optional().nullable(),lyrics:R().max(1e4,"As letras devem ter no m√°ximo 10000 caracteres").trim().optional().nullable(),hashtags:O(R().max(50).trim()).max(20,"M√°ximo de 20 hashtags").optional().default([]),status:L(["draft","published","archived"]).default("draft")}),M=_({email:R().email("Email inv√°lido").min(1,"O email √© obrigat√≥rio").max(255,"Email muito longo"),password:R().min(6,"A senha deve ter no m√≠nimo 6 caracteres").max(100,"Senha muito longa")});function F(e,t){const s=e.safeParse(t);return s.success?{success:!0,data:s.data}:{success:!1,error:s.error.errors.map(e=>`${e.path.join(".")}: ${e.message}`).join(", ")}}function $(e,t={}){return e&&"string"==typeof e?D.sanitize(e,i(i({},{ALLOWED_TAGS:[],ALLOWED_ATTR:[],KEEP_CONTENT:!0}),t)):""}function Y(e){if(!e||"string"!=typeof e)return"";const t=D.sanitize(e,{ALLOWED_TAGS:[],ALLOWED_ATTR:[]});try{const e=new URL(t);return["http:","https:","mailto:"].includes(e.protocol)?t:""}catch(s){return""}}_({query:R().max(100,"A busca deve ter no m√°ximo 100 caracteres").trim()}),R().refine(e=>!e||""===e.trim()||[/tiktok\.com\/@[^/]+\/video\/\d+/,/vm\.tiktok\.com\/[A-Za-z0-9]+/,/^\d{15,20}$/].some(t=>t.test(e)),{message:"URL do TikTok inv√°lida. Use: https://www.tiktok.com/@usuario/video/ID ou https://vm.tiktok.com/ID"}),R().refine(e=>!e||""===e.trim()||[/(?:youtube\.com|youtu\.be)\/.+/,/^[A-Za-z0-9_-]{11}$/].some(t=>t.test(e)),{message:"URL do YouTube inv√°lida"});const I=P("relative w-full rounded-lg border px-4 py-3 text-sm [&>svg+div]:translate-y-[-3px] [&>svg]:absolute [&>svg]:left-4 [&>svg]:top-4 [&>svg]:text-foreground [&>svg~*]:pl-7",{variants:{variant:{default:"bg-background text-foreground",destructive:"border-destructive/50 text-destructive dark:border-destructive [&>svg]:text-destructive"}},defaultVariants:{variant:"default"}}),V=o.forwardRef((e,t)=>{var s=e,{className:a,variant:r}=s,n=l(s,["className","variant"]);return c.jsx("div",i({ref:t,role:"alert",className:g(I({variant:r}),a)},n))});V.displayName="Alert",o.forwardRef((e,t)=>{var s=e,{className:a}=s,r=l(s,["className"]);return c.jsx("h5",i({ref:t,className:g("mb-1 font-medium leading-none tracking-tight",a)},r))}).displayName="AlertTitle";const q=o.forwardRef((e,t)=>{var s=e,{className:a}=s,r=l(s,["className"]);return c.jsx("div",i({ref:t,className:g("text-sm [&_p]:leading-relaxed",a)},r))});function W({onBackToLogin:e}){const[t,s]=o.useState(""),[a,r]=o.useState(!1),[i,l]=o.useState({type:"",text:""}),[h,f]=o.useState(!1);return h?c.jsx("div",{className:"min-h-screen bg-gradient-to-br from-blue-50 to-indigo-100 flex items-center justify-center p-4",children:c.jsx(k,{className:"w-full max-w-md",children:c.jsx(S,{className:"pt-6",children:c.jsxs("div",{className:"text-center",children:[c.jsx(d,{className:"w-12 h-12 text-green-600 mx-auto mb-4"}),c.jsx("h2",{className:"text-xl font-semibold text-green-800 mb-2",children:"Email Envoy√© !"}),c.jsx("p",{className:"text-gray-600 mb-4",children:"V√©rifiez votre bo√Æte de r√©ception et suivez les instructions pour r√©initialiser votre mot de passe."}),c.jsxs(y,{onClick:e,variant:"outline",className:"w-full",children:[c.jsx(m,{className:"w-4 h-4 mr-2"}),"Retour √† la connexion"]})]})})})}):c.jsx("div",{className:"min-h-screen bg-gradient-to-br from-blue-50 to-indigo-100 flex items-center justify-center p-4",children:c.jsxs(k,{className:"w-full max-w-md",children:[c.jsxs(A,{className:"text-center",children:[c.jsx("div",{className:"mx-auto w-12 h-12 bg-blue-100 rounded-full flex items-center justify-center mb-4",children:c.jsx(u,{className:"w-6 h-6 text-blue-600"})}),c.jsx(E,{className:"text-2xl font-bold text-gray-900",children:"R√©initialiser le mot de passe"}),c.jsx(T,{children:"Entrez votre email pour recevoir un lien de r√©initialisation"})]}),c.jsxs(S,{children:[c.jsxs("form",{onSubmit:e=>n(null,null,function*(){e.preventDefault(),r(!0),l({type:"",text:""});try{const{error:e}=yield N.auth.resetPasswordForEmail(t.trim(),{redirectTo:"https://www.amusicadasegunda.com/#/admin"});if(e)throw e;f(!0),l({type:"success",text:"Email de r√©initialisation envoy√© ! V√©rifiez votre bo√Æte de r√©ception."})}catch(s){l({type:"error",text:`Erreur: ${s.message}`})}finally{r(!1)}}),className:"space-y-4",children:[i.text&&c.jsx(V,{variant:"error"===i.type?"destructive":"default",children:c.jsx(q,{children:i.text})}),c.jsxs("div",{className:"space-y-2",children:[c.jsx("label",{htmlFor:"email",className:"text-sm font-medium text-gray-700",children:"Email"}),c.jsx(w,{id:"email",type:"email",placeholder:"admin@amusicadasegunda.com",value:t,onChange:e=>s(e.target.value),required:!0,disabled:a,className:"w-full"})]}),c.jsx(y,{type:"submit",className:"w-full bg-blue-600 hover:bg-blue-700 text-white",disabled:a,children:a?c.jsxs(c.Fragment,{children:[c.jsx(x,{className:"w-4 h-4 animate-spin mr-2"}),"Envoi en cours..."]}):c.jsxs(c.Fragment,{children:[c.jsx(u,{className:"w-4 h-4 mr-2"}),"Envoyer le lien"]})})]}),c.jsx("div",{className:"mt-6 text-center",children:c.jsxs("button",{onClick:e,className:"text-blue-600 hover:text-blue-700 font-medium",disabled:a,children:[c.jsx(m,{className:"w-4 h-4 inline mr-1"}),"Retour √† la connexion"]})}),c.jsx("div",{className:"mt-4 p-3 bg-blue-50 rounded-lg",children:c.jsx("p",{className:"text-xs text-blue-800 text-center",children:"üí° Le lien de r√©initialisation sera envoy√© √† l'adresse email fournie"})})]})]})})}function B(){const[e,t]=o.useState(""),[s,a]=o.useState(""),[r,i]=o.useState(!1),[l,d]=o.useState(!1),[m,u]=o.useState(""),[g,_]=o.useState(!1),[L,O]=o.useState(!0),[R,C]=o.useState(!1);o.useEffect(()=>{z()},[]);const z=()=>n(null,null,function*(){try{const{data:{session:e}}=yield N.auth.getSession();e&&((yield D(e.user.id))?(_(!0),setTimeout(()=>{window.location.href="/admin"},1e3)):u("‚ùå Vous n'avez pas les droits d'administrateur"))}catch(e){}finally{O(!1)}}),D=e=>n(null,null,function*(){try{const{data:t,error:s}=yield N.from("admins").select("user_id").eq("user_id",e).single();return!s&&!!t}catch(t){return!1}});return R?c.jsx(W,{onBackToLogin:()=>C(!1)}):L?c.jsxs("div",{className:"min-h-screen bg-gradient-to-br from-blue-50 to-indigo-100 flex items-center justify-center p-4",children:[c.jsx(h,{children:c.jsx("meta",{name:"robots",content:"noindex,nofollow"})}),c.jsxs("div",{className:"text-center",children:[c.jsx(x,{className:"w-8 h-8 animate-spin mx-auto mb-4 text-blue-600"}),c.jsx("p",{className:"text-gray-600",children:"V√©rification de l'authentification..."})]})]}):g?c.jsx("div",{className:"min-h-screen bg-gradient-to-br from-blue-50 to-indigo-100 flex items-center justify-center p-4",children:c.jsx(k,{className:"w-full max-w-md",children:c.jsx(S,{className:"pt-6",children:c.jsxs("div",{className:"text-center",children:[c.jsx(f,{className:"w-12 h-12 text-green-600 mx-auto mb-4"}),c.jsx("h2",{className:"text-xl font-semibold text-green-800 mb-2",children:"‚úÖ Authentifi√© avec succ√®s"}),c.jsx("p",{className:"text-gray-600 mb-4",children:"Redirection vers l'Admin en cours..."}),c.jsx(x,{className:"w-6 h-6 animate-spin mx-auto text-blue-600"})]})})})}):c.jsxs("div",{className:"min-h-screen bg-gradient-to-br from-blue-50 to-indigo-100 flex items-center justify-center p-4",children:[c.jsxs(h,{children:[c.jsx("meta",{name:"robots",content:"noindex,nofollow"}),c.jsx("link",{rel:"canonical",href:"https://www.amusicadasegunda.com/#/login"})]}),c.jsxs(k,{className:"w-full max-w-md",children:[c.jsxs(A,{className:"text-center",children:[c.jsx("div",{className:"mx-auto w-12 h-12 bg-blue-100 rounded-full flex items-center justify-center mb-4",children:c.jsx(f,{className:"w-6 h-6 text-blue-600"})}),c.jsx(E,{className:"text-2xl font-bold text-gray-900",children:"Connexion Admin"}),c.jsx(T,{children:"Acc√®s r√©serv√© aux administrateurs de M√∫sica da Segunda"})]}),c.jsxs(S,{children:[c.jsxs("form",{onSubmit:t=>n(null,null,function*(){t.preventDefault(),d(!0),u("");const a=$(e.trim()),r=$(s),i=F(M,{email:a,password:r});if(!i.success)return u(i.error),void d(!1);try{const{data:e,error:t}=yield N.auth.signInWithPassword({email:i.data.email,password:i.data.password});if(t)throw t;e.user&&((yield D(e.user.id))?(_(!0),window.location.href="/admin"):(yield N.auth.signOut(),u("‚ùå Vous n'avez pas les droits d'administrateur. Contactez l'administrateur du syst√®me.")))}catch(l){u(`‚ùå Erreur de connexion: ${l.message}`)}finally{d(!1)}}),className:"space-y-4",children:[m&&c.jsx(V,{variant:"destructive",children:c.jsx(q,{children:m})}),c.jsxs("div",{className:"space-y-2",children:[c.jsx("label",{htmlFor:"email",className:"text-sm font-medium text-gray-700",children:"Email"}),c.jsx(w,{id:"email",type:"email",placeholder:"admin@amusicadasegunda.com",value:e,onChange:e=>t(e.target.value),required:!0,disabled:l,className:"w-full"})]}),c.jsxs("div",{className:"space-y-2",children:[c.jsx("label",{htmlFor:"password",className:"text-sm font-medium text-gray-700",children:"Mot de passe"}),c.jsxs("div",{className:"relative",children:[c.jsx(w,{id:"password",type:r?"text":"password",placeholder:"‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢",value:s,onChange:e=>a(e.target.value),required:!0,disabled:l,className:"w-full pr-10"}),c.jsx("button",{type:"button",onClick:()=>i(!r),className:"absolute right-3 top-1/2 transform -translate-y-1/2 text-gray-400 hover:text-gray-600",disabled:l,children:r?c.jsx(b,{className:"w-4 h-4"}):c.jsx(p,{className:"w-4 h-4"})})]})]}),c.jsx(y,{type:"submit",className:"w-full bg-blue-600 hover:bg-blue-700 text-white",disabled:l,children:l?c.jsxs(c.Fragment,{children:[c.jsx(x,{className:"w-4 h-4 animate-spin mr-2"}),"Connexion..."]}):c.jsxs(c.Fragment,{children:[c.jsx(v,{className:"w-4 h-4 mr-2"}),"Se connecter"]})})]}),c.jsxs("div",{className:"mt-6 text-center space-y-2",children:[c.jsxs("p",{className:"text-sm text-gray-600",children:["Mot de passe oubli√© ?"," ",c.jsxs("button",{onClick:()=>C(!0),className:"text-blue-600 hover:text-blue-700 font-medium",disabled:l,children:[c.jsx(j,{className:"w-4 h-4 inline mr-1"}),"R√©initialiser"]})]}),c.jsxs("p",{className:"text-sm text-gray-600",children:["Pas de compte ?"," ",c.jsx("button",{onClick:()=>n(null,null,function*(){u("‚ÑπÔ∏è Pour cr√©er un compte administrateur, contactez l'administrateur du syst√®me.")}),className:"text-blue-600 hover:text-blue-700 font-medium",disabled:l,children:"Contacter l'administrateur"})]})]}),c.jsx("div",{className:"mt-4 p-3 bg-blue-50 rounded-lg",children:c.jsx("p",{className:"text-xs text-blue-800 text-center",children:"üîí Cette page est prot√©g√©e. Seuls les administrateurs autoris√©s peuvent y acc√©der."})})]})]})]})}q.displayName="AlertDescription";const G=Object.freeze(Object.defineProperty({__proto__:null,default:B},Symbol.toStringTag,{value:"Module"}));export{V as A,B as L,$ as a,F as b,U as c,q as d,G as e,Y as s};
