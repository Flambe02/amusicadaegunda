import{r as n,j as t}from"./vendor-react-Ck48mHws.js";import{S as z,B as y}from"./index-D14CYHZ_.js";import{W as L,Y as J,a8 as Y}from"./vendor-ui-COCjBdg-.js";import"./vendor-supabase-C24DOd3p.js";import"./vendor-date-BfA9-vu0.js";const q=["Janeiro","Fevereiro","MarÃ§o","Abril","Maio","Junho","Julho","Agosto","Setembro","Outubro","Novembro","Dezembro"],H=["#3B82F6","#6366F1","#EC4899","#F97316","#10B981","#EAB308","#F59E0B","#EF4444","#8B5CF6","#14B8A6","#06B6D4","#F43F5E"];function V(r){return r?r.toLowerCase().normalize("NFD").replace(/[\u0300-\u036f]/g,"").replace(/[^\w\s-]/g,"").replace(/\s+/g,"-").replace(/-+/g,"-").trim():null}function Z(r){if(!r)return null;const u=r.match(/(?:youtube\.com\/watch\?v=|youtu\.be\/|youtube-nocookie\.com\/embed\/|music\.youtube\.com\/watch\?v=)([a-zA-Z0-9_-]{11})/);return u?u[1]:null}function T(r,u,f){if(!r||u.length===0)return;const e=r.getContext("2d"),i=r.width,s=i/2,o=s-8,h=2*Math.PI/u.length;e.clearRect(0,0,i,i),e.save(),e.shadowColor="rgba(0,0,0,0.2)",e.shadowBlur=20,e.beginPath(),e.arc(s,s,o,0,2*Math.PI),e.fillStyle="#fff",e.fill(),e.restore(),u.forEach(({label:g,color:c},w)=>{const m=f+w*h,p=m+h,d=e.createRadialGradient(s,s,o*.25,s,s,o);d.addColorStop(0,c+"dd"),d.addColorStop(1,c),e.beginPath(),e.moveTo(s,s),e.arc(s,s,o,m,p),e.closePath(),e.fillStyle=d,e.fill(),e.strokeStyle="rgba(255,255,255,0.55)",e.lineWidth=1.5,e.stroke(),e.save(),e.translate(s,s),e.rotate(m+h/2),e.textAlign="center",e.fillStyle="#fff",e.font="bold 13px system-ui, sans-serif",e.shadowColor="rgba(0,0,0,0.55)",e.shadowBlur=4,e.fillText(g,o*.65,5),e.restore()}),e.beginPath(),e.arc(s,s,30,0,2*Math.PI),e.fillStyle="#fff",e.fill(),e.strokeStyle="#ddd",e.lineWidth=2,e.stroke(),e.fillStyle="#32a2dc",e.font="18px system-ui",e.textAlign="center",e.textBaseline="middle",e.fillText("ðŸŽµ",s,s)}function te(){var C,S,M,R,B,_;const[r,u]=n.useState([]),[f,e]=n.useState(!0),[i,s]=n.useState(!1),[o,h]=n.useState(null),g=n.useRef(null),c=n.useRef(0),w=n.useRef(null),m=360,p=n.useMemo(()=>{const l={};return r.forEach(a=>{if(a.release_date){const x=new Date(a.release_date).getMonth();l[x]||(l[x]=[]),l[x].push(a)}}),l},[r]),d=n.useMemo(()=>q.map((l,a)=>({label:l.slice(0,3),fullName:l,color:H[a],monthIndex:a,count:(p[a]||[]).length})),[p]);n.useEffect(()=>{z.list("-release_date").then(l=>{u(l||[]),e(!1)})},[]),n.useEffect(()=>{d.length>0&&T(g.current,d,c.current)},[d]);const N=()=>{if(i||f)return;h(null),s(!0);const l=d.filter(b=>b.count>0);if(l.length===0){s(!1);return}const a=l[Math.floor(Math.random()*l.length)],x=2*Math.PI/12;let j=-Math.PI/2-a.monthIndex*x-x/2-c.current%(2*Math.PI);j<=0&&(j+=2*Math.PI);const A=c.current+(6+Math.floor(Math.random()*4))*2*Math.PI+j,O=4500,F=c.current,D=performance.now(),G=b=>1-Math.pow(1-b,4),I=b=>{const E=Math.min((b-D)/O,1);if(c.current=F+(A-F)*G(E),T(g.current,d,c.current),E<1)w.current=requestAnimationFrame(I);else{c.current=A;const P=p[a.monthIndex]||[],W=P[Math.floor(Math.random()*P.length)];h({monthName:a.fullName,monthColor:a.color,song:W}),s(!1)}};w.current=requestAnimationFrame(I)},v=o!=null&&o.song?Z(o.song.youtube_url):null,k=o!=null&&o.song?V(o.song.title):null;return t.jsxs("div",{className:"min-h-screen bg-gradient-to-b from-sky-50 via-white to-blue-50",children:[t.jsxs("div",{className:"text-center pt-6 pb-4 px-4",children:[t.jsx("h1",{className:"text-3xl font-black text-gray-800 tracking-tight",children:"A Roda de Segunda"}),t.jsx("p",{className:"text-gray-500 mt-1 text-sm",children:"Gire a roda â€” cada mÃªs esconde uma mÃºsica!"})]}),t.jsxs("div",{className:"max-w-5xl mx-auto px-4 pb-16 flex flex-col lg:flex-row lg:items-start lg:gap-12",children:[t.jsxs("div",{className:"flex flex-col items-center flex-shrink-0",children:[t.jsxs("div",{className:"relative",style:{width:m},children:[t.jsx("div",{className:"absolute z-10",style:{top:-14,left:"50%",transform:"translateX(-50%)"},children:t.jsx("svg",{width:"28",height:"22",viewBox:"0 0 28 22",children:t.jsx("polygon",{points:"14,20 2,0 26,0",fill:"#1a1a2e",stroke:"white",strokeWidth:"2"})})}),t.jsx("canvas",{ref:g,width:m,height:m,className:"cursor-pointer rounded-full",style:{touchAction:"manipulation"},onClick:N})]}),t.jsx(y,{onClick:N,disabled:i||f,className:"mt-5 px-10 py-3 bg-[#32a2dc] hover:bg-[#2891c8] text-white font-black rounded-2xl text-lg shadow-lg transition-all hover:scale-105 disabled:opacity-60 disabled:scale-100",children:f?"Carregando...":i?"â³ Girando...":"Girar a Roda!"})]}),t.jsxs("div",{className:"flex-1 mt-8 lg:mt-0",children:[!o&&!i&&t.jsxs("div",{className:"hidden lg:flex flex-col items-center justify-center h-72 rounded-3xl border-2 border-dashed border-gray-200 text-gray-300",children:[t.jsx("div",{className:"text-5xl mb-3",children:"ðŸŽ¡"}),t.jsx("p",{className:"text-base font-medium",children:"Gire a roda para descobrir uma mÃºsica!"})]}),o&&!i&&t.jsxs("div",{className:"bg-white rounded-3xl shadow-xl overflow-hidden border-t-4",style:{borderColor:o.monthColor},children:[t.jsxs("div",{className:"px-6 py-4 text-white",style:{backgroundColor:o.monthColor},children:[t.jsx("p",{className:"text-xs font-bold uppercase tracking-widest opacity-80",children:"MÃªs sorteado"}),t.jsx("h2",{className:"text-2xl font-black",children:o.monthName})]}),t.jsxs("div",{className:"px-6 py-5",children:[t.jsxs("div",{className:"flex items-center gap-3 mb-4",children:[t.jsx("div",{className:"w-12 h-12 rounded-2xl flex items-center justify-center flex-shrink-0",style:{backgroundColor:o.monthColor+"22"},children:t.jsx(L,{className:"w-6 h-6",style:{color:o.monthColor}})}),t.jsxs("div",{className:"min-w-0 flex-1",children:[t.jsx("p",{className:"text-xs text-gray-400 uppercase tracking-widest font-semibold",children:"MÃºsica sorteada"}),t.jsxs("div",{className:"flex items-center gap-2",children:[t.jsx("h3",{className:"text-xl font-black text-gray-800 truncate",children:(C=o.song)==null?void 0:C.title}),k&&t.jsx("a",{href:`/musica/${k}/`,title:"Ver pÃ¡gina da mÃºsica",className:"flex-shrink-0 w-8 h-8 rounded-full flex items-center justify-center transition-all hover:scale-110 border-2",style:{borderColor:o.monthColor,color:o.monthColor,backgroundColor:"#fff"},children:t.jsx(J,{className:"w-4 h-4"})})]}),((S=o.song)==null?void 0:S.artist)&&t.jsx("p",{className:"text-gray-500 text-sm",children:o.song.artist})]})]}),v&&t.jsx("div",{className:"rounded-2xl overflow-hidden mb-4 shadow-md",style:{aspectRatio:"16/9"},children:t.jsx("iframe",{src:`https://www.youtube-nocookie.com/embed/${v}?autoplay=1&rel=0&modestbranding=1`,title:(M=o.song)==null?void 0:M.title,allow:"accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture",allowFullScreen:!0,className:"w-full h-full",style:{border:"none",display:"block",height:"100%",width:"100%"}})}),t.jsxs("div",{className:"flex flex-col gap-2",children:[((R=o.song)==null?void 0:R.spotify_url)&&t.jsx("a",{href:o.song.spotify_url,target:"_blank",rel:"noopener noreferrer",className:"block",children:t.jsx(y,{className:"w-full bg-[#1DB954] hover:bg-[#1ed760] text-white font-bold py-3 rounded-2xl text-sm transition-all hover:scale-105",children:"ðŸŽ§ Ouvir no Spotify"})}),((B=o.song)==null?void 0:B.youtube_url)&&t.jsx("a",{href:o.song.youtube_url,target:"_blank",rel:"noopener noreferrer",className:"block",children:t.jsx(y,{className:"w-full bg-[#FF0000] hover:bg-[#cc0000] text-white font-bold py-3 rounded-2xl text-sm transition-all hover:scale-105",children:"ðŸ“º Ouvir no YouTube"})}),((_=o.song)==null?void 0:_.apple_music_url)&&t.jsx("a",{href:o.song.apple_music_url,target:"_blank",rel:"noopener noreferrer",className:"block",children:t.jsx(y,{className:"w-full bg-gradient-to-r from-[#FA233B] to-[#FB5C74] hover:opacity-90 text-white font-bold py-3 rounded-2xl text-sm transition-all hover:scale-105",children:"ðŸŽµ Ouvir no Apple Music"})}),t.jsxs(y,{variant:"outline",onClick:()=>{h(null),N()},className:"w-full font-bold py-3 rounded-2xl text-sm gap-2 mt-1 border-2",style:{borderColor:o.monthColor,color:o.monthColor},children:[t.jsx(Y,{className:"w-4 h-4"}),"Girar de novo!"]})]})]})]})]})]})]})}export{te as default};
